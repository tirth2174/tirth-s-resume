(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{3107:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(n(4309),t),i(n(4328),t),i(n(4341),t);var s=n(3276);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o(s).default}})},3172:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));class r{constructor(e,t){this.defaultPrevented=!1,this.immediateStopped=!1,this.stopped=!1,this.type=e,this.data=t}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.stopped=!0}stopImmediatePropagation(){this.immediateStopped=!0}}var i=n(4313);function o(e,t,n){for(let r=0,i=e.length;r<i;r++){const i=e[r];if((null==i?void 0:i.listener)===t&&i.options.once===n.once)return r}return-1}function s(e,t,n,r={}){if(!n)return!1;const i=e[t];return!i||!i.length||-1===o(i,n,r)}function a(e,t,n,r={}){if(!t||!n)return;const i=e[t],o={listener:n,options:r};i?i.push(o):e[t]=[o]}class c{constructor(){this._listeners={},this._metaListeners={add:{},remove:{}}}_dispatchFromStore(e,t){const n=t.type;let r=e[n];if(r){r=r.slice(0);for(const e of r)if(e.listener.call(this,t),e.options.once&&this.removeListener(n,e.listener,e.options),t.immediateStopped)break}}createEvent(e,t){return new r(e,t)}on(e,t,n={}){if(!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;const i=this._listeners;if(s(i,e,t,n)){const o=this._metaListeners.add,s=o[e];if(s&&s.length){const i=new r(e,{listener:t,options:n});if(this._dispatchFromStore(o,i),i.defaultPrevented)return this}a(i,e,t,n)}return this}addListener(e,t,n={}){return this.on(e,t,n)}addListeners(e){for(const t in e)e.hasOwnProperty(t)&&this.on(t,e[t]);return this}once(e,t){return this.on(e,t,{once:!0})}removeListener(e,t,n={}){if(!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;const i=this._listeners[e];if(!i)return this;const s=o(i,t,n);if(-1===s)return this;const a=this._metaListeners.remove[e];if(a&&a.length){const i=new r(e,{listener:t,options:n});if(this._dispatchFromStore(this._metaListeners.remove,i),i.defaultPrevented)return this}return i.splice(s,1),this}removeListeners(e){for(const t in e)e.hasOwnProperty(t)&&this.removeListener(t,e[t]);return this}removeAllListeners(e){return e?this._listeners[e]=[]:this._listeners={},this}emit(e,t){if(!e)throw new TypeError("Argument `eventType` is required.");const n=this.createEvent(e,t);return Object(i.a)(()=>this._dispatchFromStore(this._listeners,n)),n}emitSync(e,t){if(!e)throw new TypeError("Argument `eventType` is required.");const n=this.createEvent(e,t);return this._dispatchFromStore(this._listeners,n),n}emitEvent(e){return Object(i.a)(()=>this._dispatchFromStore(this._listeners,e)),e}emitEventSync(e){return this._dispatchFromStore(this._listeners,e),e}emitAndWait(e,t,n){if(!e)throw new TypeError("Argument `eventType` is required.");const r=this.createEvent(e,t);return Object(i.a)(()=>{this._dispatchFromStore(this._listeners,r),n.call(this,r)}),r}emitEventAndWait(e,t){return Object(i.a)(()=>{this._dispatchFromStore(this._listeners,e),t.call(this,e)}),e}proxyEmit(e,t,n){if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!n)throw new TypeError("Parameter sourceType and targetType are required.");const r=e=>{e.stopped||this.emitAndWait(n,e.data,t=>{t.defaultPrevented&&e.preventDefault()})};return e.on(t,r),r}proxyEmitSync(e,t,n){if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!n)throw new TypeError("Parameter sourceType and targetType are required.");const r=e=>{if(e.stopped)return;const t=this.createEvent(n,e.data);this.emitEventSync(t),t.defaultPrevented&&e.preventDefault()};return e.on(t,r),r}proxyEmitAll(e,t){for(const n in t)t.hasOwnProperty(n)&&this.proxyEmit(e,n,t[n])}proxyEmitAllSync(e,t){for(const n in t)t.hasOwnProperty(n)&&this.proxyEmitSync(e,n,t[n])}onAddListener(e,t,n={}){const r=this._metaListeners.add;return s(r,e,t,n)&&a(r,e,t,n),this}onRemoveListener(e,t,n={}){const r=this._metaListeners.remove;return s(r,e,t,n)&&a(r,e,t,n),this}}},3276:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendMetric=t.reportMetrics=t.createSemanticMetrics=t.asNanoseconds=t.MetricTypes=void 0;const o=i(n(3414)),s=n(4311);t.MetricTypes={COUNTER:"counter",GAUGE:"gauge",TIMER:"timer"},t.asNanoseconds=function(e){return e};const a=(e,t)=>r(void 0,void 0,void 0,(function*(){if(Array.isArray(t.reporter)){const n=t.reporter.map(t=>t.send(e));yield Promise.all(n)}else yield t.reporter.send(e)}));t.reportMetrics=a;const c=e=>{void 0!==e.dev&&e.dev&&(e.reporter=new s.NoopReporter);const t={queue:[],timeout:void 0,flush(){return r(this,void 0,void 0,(function*(){yield a(this.queue,e),this.queue=[],this.timeout=void 0}))}};let n=!1;void 0===e.batching&&(e.batching={delay:4e3}),e.batching&&"object"==typeof window&&"function"==typeof window.addEventListener&&window.addEventListener("beforeunload",()=>{n=!0,t.flush()});return{sendMetric:i=>r(void 0,void 0,void 0,(function*(){var r,o;const s=Object.assign({},i);if(i.tags&&(s.tags=Object.assign({},i.tags)),s.key=s.key||e.key,!s.key)throw new Error(`metric.key is required. Got: "${s.key}". Set it in createSemanticMetrics(...) or pass it to sendMetric(...).`);s.tags=Object.assign({app:null!==(r=e.app)&&void 0!==r?r:s.key,application:null!==(o=e.app)&&void 0!==o?o:s.key},s.tags),e.component_id?s.component_id=s.component_id||e.component_id:s.component_id=e.key,e.batching&&!n?(t.queue.push(s),t.timeout||(t.timeout=setTimeout(()=>t.flush(),e.batching.delay))):yield a([s],e)})),config:e,isWindowUnloading:n,flush:()=>e.batching?t.flush():(o.default.warn("Manual flushing only supported in batch mode. Set config.batching: true"),Promise.resolve())}};t.createSemanticMetrics=c;class u{static init(e){u.config&&o.default.error("SemanticMetrics has already been initialized. This may lead to dangerous side effects such as your metrics disappearing from Grafana due to the `key` value being overwritten by something else"),o.default.warn("The singleton usage of SemanticMetrics will be deprecated. Please use createSemanticMetrics()"),u.config=e;const{sendMetric:t,isWindowUnloading:n}=c(e);u.sendMetric=t,u.isWindowUnloading=n}}t.default=u;t.sendMetric=e=>r(void 0,void 0,void 0,(function*(){if(!u.config)throw new Error("SemanticMetrics has not been initialized. Call SemanticMetrics.init()");return u.sendMetric(e)}))},3277:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.DEALER_CONNECTION_ERROR="DEALER_CONNECTION_ERROR",e.DEALER_AUTHENTICATION_FAILED="DEALER_AUTHENTICATION_FAILED",e.DEALER_ERROR="DEALER_ERROR",e.ENDPOINT_NOT_DEFINED="ENDPOINT_NOT_DEFINED",e.INVALID_ENDPOINT="INVALID_ENDPOINT"}(r||(r={}))},3414:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.silly=t.verbose=t.debug=t.info=t.warn=t.error=t.log=t.logger=t.default=void 0;var i=n(4310);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r(i).default}}),Object.defineProperty(t,"logger",{enumerable:!0,get:function(){return i.logger}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return i.log}}),Object.defineProperty(t,"error",{enumerable:!0,get:function(){return i.error}}),Object.defineProperty(t,"warn",{enumerable:!0,get:function(){return i.warn}}),Object.defineProperty(t,"info",{enumerable:!0,get:function(){return i.info}}),Object.defineProperty(t,"debug",{enumerable:!0,get:function(){return i.debug}}),Object.defineProperty(t,"verbose",{enumerable:!0,get:function(){return i.verbose}}),Object.defineProperty(t,"silly",{enumerable:!0,get:function(){return i.silly}})},3415:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;class r{constructor(e=0){this.nanos=e}static fromNanos(e){return new r(e)}static fromMicros(e){return new r(1e3*e)}static fromMillis(e){return new r(1e6*e)}static fromSeconds(e){return new r(1e9*e)}static from(e){return new r(e.asNanos())}asSeconds(){return this.nanos/1e9}asMillis(){return this.nanos/1e6}asMicros(){return this.nanos/1e3}asNanos(){return Math.round(this.nanos)}}t.Time=r,r.ZERO=new r(0)},3416:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToBase64=void 0;var r=n(3756);t.hexToBase64=function(e){if(!e||e.length%2!=0)throw new TypeError("Invalid hexString value.");var t=e.split("").reduce((function(e,t,n){return n%2==0?(e.push(t),e):(e[e.length-1]=""+e[e.length-1]+t,e)}),[]),n=String.fromCharCode.apply(null,t.map((function(e){var t=parseInt(e,16);if(isNaN(t))throw new TypeError("Invalid hexString value.");return t})));return r.Base64.encode(n)}},3419:function(e,t,n){"use strict";n.r(t),n.d(t,"TransportErrors",(function(){return i})),n.d(t,"TransportEvent",(function(){return o})),n.d(t,"Method",(function(){return s})),n.d(t,"PluginEvent",(function(){return a})),n.d(t,"DisconnectionReason",(function(){return c})),n.d(t,"ConnectionObserver",(function(){return h})),n.d(t,"createAbortControllerLike",(function(){return E})),n.d(t,"createXResolveProvider",(function(){return me})),n.d(t,"DEALER_PLUGIN_NAME",(function(){return v})),n.d(t,"createBaseTransport",(function(){return ve})),n.d(t,"createTransport",(function(){return Ne}));var r={};n.r(r),n.d(r,"isSupported",(function(){return L})),n.d(r,"request",(function(){return k}));var i,o,s,a,c,u={};n.r(u),n.d(u,"request",(function(){return pe})),function(e){e.HTTP_REQUEST_ABORTED="HTTP_REQUEST_ABORTED",e.HTTP_REQUEST_FAILED="HTTP_REQUEST_FAILED",e.LOGGING_REQUEST_FAILED="LOGGING_REQUEST_FAILED",e.TRANSPORT_ENDPOINTS_PROVIDER_ERROR="TRANSPORT_ENDPOINTS_PROVIDER_ERROR",e.TRANSPORT_INVALID_STATE="TRANSPORT_INVALID_STATE",e.TRANSPORT_INVALID_TOKEN="TRANSPORT_INVALID_TOKEN",e.TRANSPORT_STALE_TOKEN="TRANSPORT_STALE_TOKEN ",e.TRANSPORT_TOKEN_PROVIDER_ERROR="TRANSPORT_TOKEN_PROVIDER_ERROR",e.TRANSPORT_LIFECYCLE_DISABLED="TRANSPORT_LIFECYCLE_DISABLED",e.TRANSPORT_UNSUPPORTED_OPTION="TRANSPORT_UNSUPPORTED_OPTION",e.XRESOLVE_INCOMPLETE_RESPONSE="XRESOLVE_INCOMPLETE_RESPONSE",e.XRESOLVE_INVALID_RESPONSE="XRESOLVE_INVALID_RESPONSE",e.XRESOLVE_REQUEST_FAILED_WITH_STATUS="XRESOLVE_REQUEST_FAILED_WITH_STATUS"}(i||(i={})),function(e){e.CONNECTION_ONLINE="online",e.CONNECTION_OFFLINE="offline",e.PRODUCT_STATE_CHANGED="product_state_changed",e.ACCESS_TOKEN="access_token",e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.BEFORE_OFFLINE_DISCONNECT="before_offline_disconnect",e.BEFORE_ONLINE_DISCONNECT="before_online_disconnect",e.CONNECTED="connected",e.CONNECTION_FAILED="connection_failed",e.CONNECTION_ID="connection_id",e.DISCONNECTED="disconnected",e.ENDPOINTS_RESOLVED="endpoints_resolved",e.LOGGED_OUT="logged_out",e.SHORT_SESSION_DISCONNECTED="short_session_disconnected",e.TOKEN_PROVIDER_ERROR="token_provider_error",e.RECONNECTED="reconnected",e.RECONNECTING="reconnecting",e.WINDOW_BEFORE_UNLOAD="beforeunload"}(o||(o={})),function(e){e.DELETE="DELETE",e.GET="GET",e.OPTIONS="OPTIONS",e.PATCH="PATCH",e.POST="POST",e.PUT="PUT",e.TRACE="TRACE"}(s||(s={})),function(e){e.TRANSPORT_AUTHENTICATE="transport_authenticate",e.TRANSPORT_AUTHENTICATE_FAILED="transport_authenticate_failed",e.TRANSPORT_CONNECT="transport_connect",e.TRANSPORT_DISCONNECT="transport_disconnect",e.TRANSPORT_ENDPOINTS_RESOLVED="transport_endpoints_resolved",e.TRANSPORT_BEFORE_PROCESS_REQUEST="transport_before_process_request",e.TRANSPORT_BEFORE_SEND_REQUEST="transport_before_send_request",e.TRANSPORT_BEFORE_RETURN_RESPONSE="transport_before_return_response",e.TRANSPORT_REQUEST="transport_request",e.PLUGIN_CONNECTION_INFO="plugin_connection_info",e.PLUGIN_DISCONNECTED="plugin_disconnected",e.PLUGIN_MESSAGE="plugin_message",e.PLUGIN_REQUEST="plugin_request",e.PLUGIN_ERROR="plugin_error"}(a||(a={})),function(e){e.RECONNECTION_FAILED="reconnection_failed",e.EXPLICIT="explicit",e.LOG_OUT="log_out",e.WINDOW_BEFORE_UNLOAD="window_before_unload"}(c||(c={}));var l=n(3172);class h extends l.a{}class d extends h{constructor(e){super();const t="undefined"!=typeof window,n=e&&e.notifyBeforeUnload;this._navigator=t&&window.navigator||null,t&&"function"==typeof window.addEventListener&&(window.addEventListener("online",this.emitSync.bind(this,o.CONNECTION_ONLINE,null)),window.addEventListener("offline",this.emitSync.bind(this,o.CONNECTION_OFFLINE,null)),n&&window.addEventListener(o.WINDOW_BEFORE_UNLOAD,this.emitSync.bind(this,o.WINDOW_BEFORE_UNLOAD,null)))}static create(e){return new d(e)}isOnline(){const e=this._navigator;return!e||!("onLine"in e)||e.onLine}}class _ extends l.a{constructor(){super(),this._aborted=!1,this.onabort=null,this.on("abort",()=>{var e;return null===(e=this.onabort)||void 0===e?void 0:e.call(this)})}static abort(){const e=new _;return e._aborted=!0,e}static signalAbort(e){"_aborted"in e&&!e._aborted&&(e._aborted=!0,e.emit("abort",null))}get aborted(){return this._aborted}set aborted(e){}addEventListener(e,t){this.addListener(e,t)}removeEventListener(e,t){this.removeListener(e,t)}dispatchEvent(){}}class f{constructor(){this.signal=new _}abort(){const e=this.signal;_.signalAbort(e)}}function p(){return"undefined"!=typeof window&&"function"==typeof window.AbortController}const E=p()?()=>new AbortController:()=>new f;var T=n(3277),O=n(3748),g=n(3749),m=n(4314);const v="dealer";class N{constructor(e){this.name=v,this._dealer=new m.a(e),this.api={hasConnectionInfo:()=>this._dealer.hasConnectionId(),getConnectionInfo:()=>this._dealer.getConnectionInfo().then(e=>Object.assign({plugin:this.name},e))},this._onDealerConnectionId=this._onDealerConnectionId.bind(this),this._onDealerDisconnected=this._onDealerDisconnected.bind(this),this._onDealerMessage=this._onDealerMessage.bind(this),this._onDealerRequest=this._onDealerRequest.bind(this),this._onTransportConnect=this._onTransportConnect.bind(this),this._onTransportAuthenticate=this._onTransportAuthenticate.bind(this),this._onTransportDisconnect=this._onTransportDisconnect.bind(this)}_onDealerConnectionId(e){this._mediator&&this._mediator.emit(a.PLUGIN_CONNECTION_INFO,Object.assign({plugin:this.name},e.data))}_onDealerDisconnected(e){if(!this._mediator)return;const t=e.data;this._mediator.emit(a.PLUGIN_DISCONNECTED,{plugin:this.name,code:t.wsCode,reason:t.reason})}_onDealerMessage(e){this._mediator&&this._mediator.emit(a.PLUGIN_MESSAGE,Object.assign({plugin:this.name},e.data))}_onDealerRequest(e){this._mediator&&this._mediator.emit(a.PLUGIN_REQUEST,Object.assign({plugin:this.name},e.data))}_onTransportConnect(e){const t=e.data.endpoints,n=e.data.awaitPromise;t.dealer?/^wss:/.test(t.dealer)?n(this._dealer.connect(t.dealer)):n(Promise.reject(new O.a(T.a.INVALID_ENDPOINT,"Dealer endpoint needs to be wss://"))):n(Promise.reject(new O.a(T.a.ENDPOINT_NOT_DEFINED,'No "dealer" endpoint defined.')))}_onTransportAuthenticate(e){const t=e.data;t.awaitPromise(this._dealer.authenticate(t.token))}_onTransportDisconnect(){this._dealer.disconnect()}_onDealerError(e){var t;null===(t=this._mediator)||void 0===t||t.emit(a.PLUGIN_ERROR,{plugin:this.name,error:e.data.error})}attach(e,t){this._mediator=t,t.addListeners({[a.TRANSPORT_CONNECT]:this._onTransportConnect,[a.TRANSPORT_AUTHENTICATE]:this._onTransportAuthenticate,[a.TRANSPORT_DISCONNECT]:this._onTransportDisconnect}),this._dealer.addListeners({[g.a.DISCONNECTED]:this._onDealerDisconnected,[g.a.CONNECTION_ID]:this._onDealerConnectionId,[g.a.MESSAGE]:this._onDealerMessage,[g.a.REQUEST]:this._onDealerRequest,[g.a.ERROR]:this._onDealerError})}detach(e,t){this._mediator=void 0,t.removeListeners({[a.TRANSPORT_CONNECT]:this._onTransportConnect,[a.TRANSPORT_AUTHENTICATE]:this._onTransportAuthenticate,[a.TRANSPORT_DISCONNECT]:this._onTransportDisconnect}),this._dealer.removeListeners({[g.a.DISCONNECTED]:this._onDealerDisconnected,[g.a.CONNECTION_ID]:this._onDealerConnectionId,[g.a.MESSAGE]:this._onDealerMessage,[g.a.REQUEST]:this._onDealerRequest,[g.a.ERROR]:this._onDealerError})}}function b(e,t){return new N(t)}var R=n(3752);const y={POST:!0,PUT:!0,DELETE:!0};var w;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.TIMED_OUT=408]="TIMED_OUT",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.REQUEST_ENTITY_TOO_LARGE=413]="REQUEST_ENTITY_TOO_LARGE",e[e.REQUEST_URI_TOO_LONG=414]="REQUEST_URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED"}(w||(w={}));class C extends Error{constructor(e,t,n){super(e),this.name="RequestError",this.message=e,this.code=t,this.status=n||0}}class P extends C{constructor(){super("Request aborted by signal.",i.HTTP_REQUEST_ABORTED,0),this.name="RequestAbortedError",this.message="Request aborted by signal."}}class I{constructor(e){this.get=e.get.bind(e),this.has=e.has.bind(e)}get(e){return null}has(e){return!1}}class A{constructor(e,t=0){this.url="",this.status=0,this.headers=null,this.body=null,this.offline=!1,this.timing=null,this.metadata=null,this.retries={count:0},this.url=e,this.status=t,this.ok=t>=200&&t<=299}getStatusFamily(){return 0|this.status/100}}const S=R.forTag("transport.http.fetch"),D={json:!0,text:!0,arraybuffer:!0,blob:!0};function L(){return"function"==typeof fetch}function k(e){if(!L())return Promise.reject(new TypeError("Fetch is not supported"));const t=e.options.signal;if(null==t?void 0:t.aborted)return Promise.reject(new P);if(!e.url)return Promise.reject(new TypeError("Request URL cannot be blank."));const n=e.method||"GET";let r=e.url,i=null;if(n in y&&e.payload?i=e.payload:e.payload&&(r+="?"+e.payload),e.options.responseType&&!(e.options.responseType in D))return Promise.reject(new TypeError("Cannot set responseType: not supported in browser."));const o={mode:e.options.mode||"cors",credentials:e.options.credentials||"same-origin",redirect:e.options.redirect||"follow",signal:t,method:n};e.headers.count()&&(o.headers=e.headers.toJSON()),i&&(o.body=i);const s=Date.now();return fetch(r,o).then((function(t){let n;n=e.options.ignoreResponseBody||t.status===w.NO_CONTENT?null:"json"===e.options.responseType?t.json().catch((function(e){return S.warn("Could not parse response as JSON:",e),null})):"arraybuffer"===e.options.responseType?t.arrayBuffer():"blob"===e.options.responseType?t.blob():t.text();const r=e.options.parseResponseHeaders||t.status>299?new I(t.headers):null;return Promise.all([t.url,t.status,r,n])})).then((function([t,n,r,i]){const o=new A(t,n);if(o.body=i,o.headers=r,e.options.timing){const e=Date.now()-s;o.timing={completed:e}}return o})).catch((function(t){if("AbortError"===(null==t?void 0:t.name))throw new P;const n=new A(r);if(e.options.timing){const e=Date.now()-s;n.timing={completed:e}}return n})).then((function(t){return e.options.connectionObserver&&(t.offline=!e.options.connectionObserver.isOnline()),t}))}function x(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;var j=n(3750);const U=200,M=0,F="linear",q=!0;class B{constructor(e={}){this._curve=e.curve||F,this._baseTime=e.baseTime||U,this._ceiling=e.ceiling||M,this._jitter="jitter"in e?!!e.jitter:q}getTime(e){let t;switch(this._curve){case"static":t=1;break;case"logarithmic":t=Math.log(e);break;case"exponential":t=Math.pow(Math.E,e);break;case"linear":default:t=e+1}let n=Math.min(4294967296,Math.floor(t*this._baseTime));return this._ceiling&&(n=Math.min(n,this._ceiling)),this._jitter?function(e){const t=e/5;return Math.floor(e-t/2+Math.random()*t)}(n):n}}const G={backoffInitial:!1,baseTime:200,ceiling:0,curve:"linear",jitter:!0,maxDuration:1/0,maxRetries:1/0,maxTime:1/0,retryPredicate:()=>!0};class H{constructor(e,t){this._resolver=Object(j.a)(),this._ts=0,this._callCount=0,this._tickInterval=0,this._isRunning=!1,this._isDestroyed=!1;const n=Object.assign(Object.assign({},G),t),{backoffInitial:r,maxDuration:i,maxRetries:o,maxTime:s,retryPredicate:a}=n,c=x(n,["backoffInitial","maxDuration","maxRetries","maxTime","retryPredicate"]);this._fn=e,this._backoffInitial=r,this._maxDuration=i,this._maxRetries=o,this._maxTime=s,this._retryPredicate=a,this._backoffInitial=r,this._counter=new B(c),this._backoffInitial&&(this._maxRetries+=1)}static init(e,t={}){return new H(e,t).start()}_destroy(){this._isRunning=!1,this._isDestroyed=!0}_failure(e){if(!this._isDestroyed)if(e&&"retryAfter"in e)this._retryAfter(e);else{const t=this._counter.getTime(this._callCount);this._shouldRetry(t,e)?(this._callCount++,this._tickInterval=setTimeout(()=>this._tick(),t)):(this._resolver.reject(e),this._destroy())}}_retryAfter(e){this._callCount++,this._tickInterval=setTimeout(()=>this._tick(),e.retryAfter)}_success(...e){this._isDestroyed||(this._resolver.resolve(...e),this._destroy())}_shouldRetry(e,t){const n=Date.now()-this._ts+e;return this._callCount<this._maxRetries&&e<this._maxTime&&n<this._maxDuration&&this._retryPredicate(t)}_tick(){this._fn().then((...e)=>this._success(...e)).catch(e=>this._failure(e))}getResolver(){return this._resolver.promise}start(){return this._isDestroyed?Promise.reject(new Error("Backoff already consumed")):(this._isRunning||(this._ts=Date.now(),this._isRunning=!0,this._backoffInitial?(this._callCount=1,this._tickInterval=setTimeout(()=>this._tick(),this._counter.getTime(0))):this._tick()),this._resolver.promise)}stop(){clearTimeout(this._tickInterval),this._destroy()}getRetryCount(){return this._callCount}}var W,V,z=n(3751);!function(e){e[e.CONNECTION_ERROR=0]="CONNECTION_ERROR",e[e.INFORMATIONAL=1]="INFORMATIONAL",e[e.SUCCESS=2]="SUCCESS",e[e.REDIRECTION=3]="REDIRECTION",e[e.CLIENT_ERROR=4]="CLIENT_ERROR",e[e.SERVER_ERROR=5]="SERVER_ERROR"}(W||(W={}));class Q extends Error{constructor(e,t,n=null){super(t),this.name="TransportError",this.message=t,this.code=e,this.origin=n}}class ${constructor(e){this._headers={},this._count=0,this._setAll(e)}_setAll(e){let t=0;for(const n in e)e.hasOwnProperty(n)&&e[n]&&(this._headers[n.toLowerCase()]=e[n],t++);this._count=t}get(e){return this._headers[e.toLowerCase()]||null}has(e){return!!this._headers[e.toLowerCase()]}set(e,t){this._headers[e.toLowerCase()]=t,this._count++}delete(e){const t=e.toLowerCase();this._headers[t]&&this._count--,delete this._headers[e.toLowerCase()]}count(){return this._count}toJSON(){return Object.assign({},this._headers)}}class K{constructor(e,t){this.url=e,this.method=(null==t?void 0:t.method)||"GET",this.headers=new $(null==t?void 0:t.headers),this.options=(null==t?void 0:t.options)||{},this.payload=null==t?void 0:t.payload,this.urlExpanded=(null==t?void 0:t.urlExpanded)||!1,this.retryOptions=(null==t?void 0:t.retryOptions)||{}}static create(e,t){return new K(e,t)}clone(){const e=new K(this.url);return e.method=this.method,e.headers=new $(this.headers.toJSON()),e.options=this.options,e.payload=this.payload,e.urlExpanded=this.urlExpanded,e.retryOptions=this.retryOptions,e}}!function(e){e.EVENT_ACCESS_TOKEN="access_token",e.EVENT_CONNECTION_ID="connection_id",e.EVENT_CONNECTION_OFFLINE="connection_offline",e.EVENT_CONNECTION_ONLINE="connection_online",e.EVENT_ENDPOINTS_RESOLVED="endpoints_resolved"}(V||(V={}));class X extends l.a{constructor(e,t){super(),this.EVENT_ACCESS_TOKEN=V.EVENT_ACCESS_TOKEN,this.EVENT_CONNECTION_ID=V.EVENT_CONNECTION_ID,this.EVENT_CONNECTION_OFFLINE=V.EVENT_CONNECTION_OFFLINE,this.EVENT_CONNECTION_ONLINE=V.EVENT_CONNECTION_ONLINE,this.EVENT_ENDPOINTS_RESOLVED=V.EVENT_ENDPOINTS_RESOLVED,this.StatusCode=w,this.StatusFamily=W,this.getConnectionId=e.getConnectionId.bind(e),this.getEndpoints=e.getEndpoints.bind(e),this.getInitTime=e.getInitTime.bind(e),this.getLastToken=e.getLastToken.bind(e),this.matchMessages=e.matchMessages.bind(e),this.unmatchMessages=e.unmatchMessages.bind(e),this.handlePushRequests=e.handlePushRequests.bind(e),this.unhandlePushRequests=e.unhandlePushRequests.bind(e),this.hasPlugin=e.hasPlugin.bind(e),this.getPluginAPI=e.getPluginAPI.bind(e);const n=e.request.bind(e);(null==t?void 0:t.requestOptions)?this.request=(e,r)=>n(e,r?Object.assign(Object.assign(Object.assign({},null==t?void 0:t.requestOptions),r),{metadata:Object.assign(Object.assign({},t.requestOptions.metadata),null==r?void 0:r.metadata),retry:Object.assign(Object.assign({},t.requestOptions.retry),null==r?void 0:r.retry)}):t.requestOptions):this.request=n,this.proxyEmit(e,o.ACCESS_TOKEN,V.EVENT_ACCESS_TOKEN),this.proxyEmit(e,o.CONNECTION_OFFLINE,V.EVENT_CONNECTION_OFFLINE),this.proxyEmit(e,o.CONNECTION_ONLINE,V.EVENT_CONNECTION_ONLINE),this.proxyEmit(e,o.ENDPOINTS_RESOLVED,V.EVENT_ENDPOINTS_RESOLVED),this.onAddListener(V.EVENT_CONNECTION_ID,this._onAddConnectionIdListener.bind(this,e.on.bind(e))),this.onRemoveListener(V.EVENT_CONNECTION_ID,this._onRemoveConnectionIdListener.bind(this,e.removeListener.bind(e)))}_onAddConnectionIdListener(e,t){t.preventDefault();const n=t.data.listener,r=e=>{const t=this.createEvent(V.EVENT_CONNECTION_ID,e.data);n.call(this,t)};n.$proxy_wrapper=r,e(o.CONNECTION_ID,r,t.data.options)}_onRemoveConnectionIdListener(e,t){t.preventDefault();const n=t.data.listener;n.$proxy_wrapper&&e(o.CONNECTION_ID,n.$proxy_wrapper,t.data.options)}removeAllListeners(){return this}}class Y{constructor(){this._startTime=null,this._endTime=null}static create(){return new Y}start(){if(null!==this._startTime)throw new Error("Measurement is already in progress.");this._startTime=Date.now()}end(){if(null===this._startTime||null!==this._endTime)throw new Error("Measurement is not in progress.");this._endTime=Date.now()}getMetrics(){if(null===this._startTime||null===this._endTime)throw new Error("Measurement is not done.");return{start_time:this._startTime,end_time:this._endTime}}}const J=R.forTag("transport.transport"),Z=/^(?:https?:\/\/)?@([^\/]+)\//,ee=/^(ws|http)s?:\/\/.*[^\/]$/,te=/^([a-zA-Z]{3},\ \d{1,2}\ [a-zA-Z]{3}\ (\d{1,2}.){3})/,ne={xhr:!0,fetch:!0},re=1,ie=4;function oe(e,t){const n="access_token="+encodeURIComponent(t),[r,i]=e.split("?");if(!i)return`${r}?${n}`;const o=i.replace(/access_token=[^&]*(&|$)/,n+"$1");return o!==i?`${r}?${o}`:`${r}?${n}&${i}`}class se extends l.a{constructor(e){if(super(),this._plugins={},this._pluginMediator=new l.a,this._connectCalled=!1,this._authenticateCalled=!1,this._endpoints=null,this._lastToken=null,this._lastTokenExpiry=0,this._refreshTokenPromise=null,this._authenticationPromise=null,this._reconnectTimeout=0,this._isReconnecting=!1,this._initTime=0,this._lastDisconnect=0,this._stateMask=0,this._quickDisconnectCount=0,this._counter=new B({curve:"exponential",baseTime:5e3,ceiling:15e3}),this._stateAwareListeners={connected:[],authenticated:[],connection_id:[],transport_connect:[],transport_authenticate:[]},this._stateAwareOperationMetrics={authenticated:null},this._stateAwareRunners={connected:null,authenticated:null,connection_id:null,transport_connect:null,transport_authenticate:null},!e)throw new TypeError("Argument `options` for Transport cannot be null.");if(!e.providers)throw new TypeError("Argument `options.providers` for Transport cannot be null.");this._ownerRef="ownerRef"in e?Object(e.ownerRef):{},this._tokenProvider=e.providers.token,this._endpointsProvider=e.providers.endpoints,this._XHR=e.XHR,this._Fetch=e.Fetch,this._reconnectionRetries=e.reconnectionRetries>=0?e.reconnectionRetries:3,this._requestMode=e.requestMode in ne?e.requestMode:"xhr",this._forcePolyfillTypes=e.forcePolyfillTypes||{},this._disableAutoLogout="disableAutoLogout"in e&&!!e.disableAutoLogout,this._disconnectBeforeUnload=e.disconnectBeforeUnload||!1;const t=e.createConnectionObserver||d.create;this._connectionObserver=t({notifyBeforeUnload:this._disconnectBeforeUnload}),this.authenticate=this.authenticate.bind(this),this._authenticateWithToken=this._authenticateWithToken.bind(this),this._connectToEndpoints=this._connectToEndpoints.bind(this),this._parseProvidedToken=this._parseProvidedToken.bind(this),this._onConnected=this._onConnected.bind(this),this._onAuthenticated=this._onAuthenticated.bind(this),this._onAuthenticationFailed=this._onAuthenticationFailed.bind(this),this._init()}static create(e){return new se(e)}_init(){this.onAddListener(o.CONNECTED,this._onAddListener.bind(this,"connected")),this.onAddListener(o.AUTHENTICATED,this._onAddListener.bind(this,"authenticated")),this.onAddListener(o.CONNECTION_ID,this._onAddListener.bind(this,"connection_id")),this.onRemoveListener(o.CONNECTED,this._onRemoveListener.bind(this,"connected")),this.onRemoveListener(o.AUTHENTICATED,this._onRemoveListener.bind(this,"authenticated")),this.onRemoveListener(o.CONNECTION_ID,this._onRemoveListener.bind(this,"connection_id")),this._pluginMediator.onAddListener(a.TRANSPORT_CONNECT,this._onAddListener.bind(this,"transport_connect")),this._pluginMediator.onAddListener(a.TRANSPORT_AUTHENTICATE,this._onAddListener.bind(this,"transport_authenticate")),this._pluginMediator.onRemoveListener(a.TRANSPORT_CONNECT,this._onRemoveListener.bind(this,"transport_connect")),this._pluginMediator.onRemoveListener(a.TRANSPORT_AUTHENTICATE,this._onRemoveListener.bind(this,"transport_authenticate")),"fetch"!==this._requestMode||this._Fetch&&this._Fetch.isSupported()||(J.warn('Default "fetch" request mode unavailable; Fallback to "xhr"'),this._requestMode="xhr");const e=this._pluginMediator;e.addListeners({[a.PLUGIN_DISCONNECTED]:this._onPluginDisconnected.bind(this)}),this.proxyEmit(e,a.PLUGIN_CONNECTION_INFO,o.CONNECTION_ID),this._disableAutoLogout||this.matchMessages("client:logout",()=>this._onLogout()),this._connectionObserver.on(o.CONNECTION_ONLINE,()=>this._onOnline()),this._connectionObserver.on(o.CONNECTION_OFFLINE,()=>this._onOffline()),this._connectionObserver.on(o.WINDOW_BEFORE_UNLOAD,()=>this._disconnect(c.WINDOW_BEFORE_UNLOAD))}_runStateAwareQueues(e,t){const n=this._stateAwareListeners[e].splice(0);for(const e of n)e.call(this,t);this._stateAwareRunners[e]=null}_connect(){return this._stateMask&re?Promise.resolve(!1):this._connectionObserver.isOnline()?this._performConnect():new Promise((e,t)=>{J.info("Waiting to go online before connecting"),this._connectionObserver.once(o.CONNECTION_ONLINE,()=>{this._performConnect().then(e,t)})})}_performConnect(){return new Promise(e=>{J.info("Resolving endpoints"),e(this._endpointsProvider(this.toPublic()))}).catch(e=>{const t=(null==e?void 0:e.code)?e:new Q(i.TRANSPORT_ENDPOINTS_PROVIDER_ERROR,(null==e?void 0:e.message)||"Endpoints provider error",null!=e?e:null);return J.error("Endpoints resolution failed",t),Promise.reject(t)}).then(this._connectToEndpoints).then(this._onConnected).catch(e=>{const t=e&&e.error?e.error:e;return this.emit(o.CONNECTION_FAILED,{error:t}),J.error("Connection failed",t),Promise.reject(t)})}_connectToEndpoints(e){const t={webgate:"",webapi:""};for(const n in e){if(!e.hasOwnProperty(n))continue;let r=e[n];r&&(ee.test(r)&&(r+="/"),t[n]=r)}this._endpoints=t,this.emit(o.ENDPOINTS_RESOLVED,{endpoints:Object.assign({},t)}),J.info("Endpoints resolved");const n=[],r=e=>{n.push(e)};return J.info("Waiting for plugins to connect"),new Promise((e,i)=>{this._pluginMediator.emitAndWait(a.TRANSPORT_CONNECT,{endpoints:Object.assign({},t),awaitPromise:r},()=>{Promise.all(n).then(()=>e(!0),i)})})}_refreshToken(e=!1){if(this._refreshTokenPromise)return this._refreshTokenPromise;if(!e&&this._lastToken&&this._lastTokenExpiry>Date.now())return Promise.resolve(this._lastToken);this._refreshTokenPromise=new Promise(e=>{J.info("Requesting token from provider"),e(this._tokenProvider())}).then(this._parseProvidedToken);const t=()=>{this._refreshTokenPromise=null};return this._refreshTokenPromise.then(t,t),this._refreshTokenPromise.catch(e=>{const t=(null==e?void 0:e.code)?e:new Q(i.TRANSPORT_TOKEN_PROVIDER_ERROR,(null==e?void 0:e.message)||"Token provider error",e);return this.emit(o.TOKEN_PROVIDER_ERROR,{error:t}),J.error("Token provider error",t),Promise.reject(t)})}_parseProvidedToken(e){let t,n;if(Array.isArray(e)?(t=e[0],n=parseInt(e[1],10),isNaN(n)&&(n=3540)):(t=e,n=3540),!t)throw this._lastToken=null,this._lastTokenExpiry=0,J.error("No token was provided"),new Q(i.TRANSPORT_INVALID_TOKEN,`Token provider returned an invalid token, "${t}"`);if(this._lastToken===t){J.error("TokenProvider returned same token twice.");const e=new Q(i.TRANSPORT_STALE_TOKEN,"Token provider returned the same token twice.");throw this._lastToken=null,this._lastTokenExpiry=0,e}return this._lastToken=t,this._lastTokenExpiry=Date.now()+1e3*n,this.emit(o.ACCESS_TOKEN,{token:t}),J.info("Access token set"),t}_authenticateWithToken(e){if(!this._endpoints)return Promise.resolve(!0);const t=[],n=e=>{t.push(e)};return J.info("Waiting for plugins to authenticate"),new Promise((r,i)=>{this._pluginMediator.emitAndWait(a.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:n},()=>{Promise.all(t).then(()=>r(!0),i)})})}_authenticate(e){if(!(this._stateMask&re))return Promise.reject(new Q(i.TRANSPORT_INVALID_STATE,"Cannot authenticate disconnected transport."));if(this._authenticationPromise)return this._authenticationPromise;const t=Y.create();return t.start(),this._authenticationPromise=H.init(()=>(J.info("Authenticating"),this._refreshToken(e).then(this._authenticateWithToken)),{curve:"exponential",maxRetries:2,baseTime:500,retryPredicate:e=>(J.warn("Retrying authentication due to failure",e),!0)}).then(()=>this._onAuthenticated(t)).catch(e=>this._onAuthenticationFailed(e,t)),this._authenticationPromise}_performDisconnect(e){this._stateMask=0;const t=!e;return e&&(this.emit(o.DISCONNECTED,{reason:e}),J.info("Disconnected")),J.info("Waiting for plugins to disconnect."),this._pluginMediator.emitSync(a.TRANSPORT_DISCONNECT,{supressed:t}),!0}_createReconnector(){let e=!1;return()=>(this._isReconnecting=!0,this.emit(o.RECONNECTING,null),J.info("Reconnecting"),this._performDisconnect(),this._connect().then(()=>!!this._authenticateCalled&&this._authenticate(e).then(t=>(e=!1,t),t=>(e=!0,Promise.reject(t)))).then(()=>(this._isReconnecting=!1,this.emit(o.RECONNECTED,null),J.info("Reconnected"),!0)))}_tryToReconnect(){this._isReconnecting?J.warn("Reconnection triggered while already reconnecting"):(this._stateMask=0,H.init(this._createReconnector(),{baseTime:1e3,maxTime:15e3,maxRetries:this._reconnectionRetries,retryPredicate:e=>(J.warn("Retrying reconnection due to failure",e),!0)}).catch(()=>{this._stateMask=0,this._isReconnecting=!1,this.emit(o.DISCONNECTED,{reason:c.RECONNECTION_FAILED}),J.info("Disconnected: reconnection failed")}))}_sendRequest(e,t={},n={}){const r=t.signal;return(null==r?void 0:r.aborted)?Promise.reject(new P):this._processRequestArgs(e,t).then(e=>(null==r?void 0:r.aborted)?Promise.reject(new P):e.options.forget?this._sendFireAndForgetRequest(e):this._sendRetriedRequest(e,n))}_processRequestArgs(e,t={}){var n,r;if(null===(n=t.signal)||void 0===n?void 0:n.aborted)return Promise.reject(new P);let i=e,o=!1;const s=Object.assign(Object.assign({},t),{forcePolyfill:!(!t.responseType||!(t.responseType in this._forcePolyfillTypes)),requestMode:null!==(r=null==t?void 0:t.requestMode)&&void 0!==r?r:this._requestMode,connectionObserver:this._connectionObserver,metadata:(null==t?void 0:t.metadata)||null});if((null==t?void 0:t.signal)&&!p()&&("fetch"===t.requestMode?J.warn("Request with `{requestMode: fetch}` but no native AbortController."):s.requestMode="xhr"),Z.test(i)){o=!0;try{i=this._tryExpandSpecialURL(i)}catch(e){return Promise.reject(e)}"authorize"in s||(s.authorize=!0,s.autoAuthorized=!0)}const a=Object.assign(Object.assign({maxRetries:2,curve:"exponential"},t.retry),{retryPredicate:e=>!(e instanceof P)});return Promise.resolve(K.create(i,{method:t.method,headers:t.headers,payload:t.payload,options:s,urlExpanded:o,retryOptions:a}))}_tryExpandSpecialURL(e){const t=this._endpoints;return e.replace(Z,(e,n)=>{if(!t.hasOwnProperty(n))throw new TypeError(`Cannot replace endpoint @${n}: endpoint not defined.`);return t[n]})}_sendFireAndForgetRequest(e){var t;const{url:n,method:r,options:o}=e;if(null===(t=o.signal)||void 0===t?void 0:t.aborted)return Promise.reject(new P);if("GET"!==r&&"POST"!==r)return Promise.reject(new Q(i.TRANSPORT_UNSUPPORTED_OPTION,`Option 'forget' cannot be used for ${r} request.`));if(!o.autoAuthorized&&o.authorize)return Promise.reject(new Q(i.TRANSPORT_UNSUPPORTED_OPTION,"Option 'forget' cannot be used for authorized request."));if(o.requestMode="xhr",o.authorize=!1,o.ignoreResponseBody=!0,"GET"===r)if("function"==typeof fetch){const e={mode:"no-cors"};o.signal&&p()&&(e.signal=o.signal),fetch(n,e).catch(()=>{})}else"function"==typeof Image?(new Image).src=n:this._sendRetriedRequest(e,{}).catch(()=>{});else if("POST"===r)if("undefined"!=typeof navigator&&(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)){const t=e.headers.get("content-type");navigator.sendBeacon(e.url,"string"==typeof e.payload&&t?new Blob([e.payload],{type:t}):e.payload)}else if("function"==typeof fetch){const t=e.headers.get("content-type"),r={method:"POST",body:e.payload,headers:t?{"content-type":t}:void 0};o.signal&&p()&&(r.signal=o.signal),fetch(n,r).catch(()=>{})}else this._sendRetriedRequest(e,{}).catch(()=>{});return Promise.resolve(new A(n,0))}_sendRetriedRequest(e,t){const n=e.retryOptions,r=e.options.signal;let i=!1;const s=()=>(null==r?void 0:r.aborted)?Promise.reject(new P):this._setAuthHeader(e,i),c=this._connectionObserver,u=new H(()=>{let u;return u=c.isOnline()||e.options.allowOffline?s():new Promise((e,t)=>{c.once(o.CONNECTION_ONLINE,()=>{s().then(e,t)})}),u.then(()=>{if(null==r?void 0:r.aborted)return Promise.reject(new P);let n;if(this._pluginMediator.emitSync(a.TRANSPORT_BEFORE_SEND_REQUEST,{request:e,context:t}),"fetch"===e.options.requestMode&&this._Fetch&&this._Fetch.isSupported())n=this._Fetch.request(e);else{if(!this._XHR)throw new Error("No available request mechanisms.");n=this._XHR.request(e)}return n}).then(t=>{if(null==r?void 0:r.aborted)return Promise.reject(new P);let o=null;if(t.headers&&(o=t.headers.get("Retry-After")),t.status===w.UNAUTHORIZED&&!e.options.ignoreUnauthorized)return i=!0,Promise.reject(t);if("function"==typeof(null==n?void 0:n.condition)&&(n.condition(t,W)||o)){if(null!==o)if(te.test(o))t.retryAfter=new Date(o).getTime()-Date.now();else{const e=parseInt(o,10);e>0&&(t.retryAfter=1e3*e)}return Promise.reject(t)}return Promise.resolve(t)})},n);return u.start().catch(this._handleRetriedRequestError).then(n=>(null==r?void 0:r.aborted)?Promise.reject(new P):(n.metadata=e.options.metadata,n.retries=n.retries||{count:0},n.retries.count=u.getRetryCount(),this._pluginMediator.emitSync(a.TRANSPORT_BEFORE_RETURN_RESPONSE,{context:t,response:n}),e.options.rejectNotOk&&!n.ok?Promise.reject(n):n))}_setAuthHeader(e,t){if(!e.options.authorize)return Promise.resolve(e);const n=()=>this._refreshToken(t).then(t=>(e.headers.set("Authorization","Bearer "+t),e));return this._stateMask&ie?n():new Promise((e,t)=>{J.info("Auth header setting awaiting authentication."),this.once(o.AUTHENTICATED,()=>{J.info("Auth header set after authentication."),n().then(e,t)})})}_handleRetriedRequestError(e){return e instanceof A?Promise.resolve(e):Promise.reject(e)}_onAddListener(e,t){const n=t.data.options;if(n.ignoreCurrentState)return;let r;switch(e){case"connected":if(!this.isConnected())return;r=Promise.resolve(this.createEvent(o.CONNECTED,null));break;case"authenticated":{if(!this.isAuthenticated())return;const e=this._stateAwareOperationMetrics.authenticated;r=Promise.resolve(this.createEvent(o.AUTHENTICATED,{timing:e}));break}case"connection_id":{const e=this.getPluginAPI("dealer");if(!e||!e.hasConnectionInfo())return;r=e.getConnectionInfo().then(e=>this.createEvent(o.CONNECTION_ID,e));break}case"transport_connect":if(!this.isConnected()||!this._endpoints)return;r=Promise.resolve(this._pluginMediator.createEvent(a.TRANSPORT_CONNECT,{endpoints:Object.assign({},this._endpoints),awaitPromise:e=>{}}));break;case"transport_authenticate":if(!this.isAuthenticated())return;r=this._refreshToken().then(e=>this._pluginMediator.createEvent(a.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:e=>{}}));break;default:return}const i=t.data.listener;this._stateAwareListeners[e].push(i);const s=this._stateAwareRunners;s[e]||(s[e]=r.then(this._runStateAwareQueues.bind(this,e)),n.once&&t.preventDefault())}_onRemoveListener(e,t){const n=t.data.options;if(n.ignoreCurrentState||n.once)return;const r=t.data.listener,i=this._stateAwareListeners[e].indexOf(r);-1!==i&&this._stateAwareListeners[e].splice(i,1)}_getQuickDisconnectTimeout(){return this._counter.getTime(this._quickDisconnectCount)}_onPluginDisconnected(e){const t=Date.now(),n=t-this._lastDisconnect;if(this._performDisconnect(),e.data.code===z.a.CLOSE)return J.info(`Plugin "${e.data.plugin}" explicitly disconnected`),void(this._quickDisconnectCount=0);this._connectionObserver.isOnline()&&(J.info(`Plugin "${e.data.plugin}" unexpectedly disconnect; trying to reconnect`),n<5e3?(this._reconnectTimeout&&clearTimeout(this._reconnectTimeout),this._quickDisconnectCount++,this.emit(o.SHORT_SESSION_DISCONNECTED,{disconnectCount:this._quickDisconnectCount,sessionLength:n}),this._reconnectTimeout=setTimeout(this._tryToReconnect.bind(this),this._getQuickDisconnectTimeout())):(this._quickDisconnectCount=0,this._lastDisconnect=t,this._tryToReconnect()))}_onOnline(){this.emit(o.CONNECTION_ONLINE,null),J.info("ConnectionObserver online"),this._connectCalled&&this._tryToReconnect()}_onOffline(){this.emit(o.CONNECTION_OFFLINE,null),J.info("ConnectioObserver offline"),this._performDisconnect()}_onConnected(){return this._stateMask|=re,this.emit(o.CONNECTED,null),J.info("Connected"),Promise.resolve(!0)}_onAuthenticated(e){e.end(),clearTimeout(this._reconnectTimeout),this._authenticationPromise=null,this._stateMask|=ie,this._initTime=Date.now();const t=e.getMetrics();return this.emit(o.AUTHENTICATED,{timing:t}),this._stateAwareOperationMetrics.authenticated=t,J.info("Authenticated"),Promise.resolve(!0)}_onAuthenticationFailed(e,t){t.end();const n=e&&e.error?e.error:e;this._authenticationPromise=null,this._stateMask&=~ie;const r={error:n,timing:t.getMetrics()};return this.emit(o.AUTHENTICATION_FAILED,r),this._pluginMediator.emit(a.TRANSPORT_AUTHENTICATE_FAILED,r),J.info("Authentication failed",n),Promise.reject(n)}_onLogout(){const e=()=>{this._lastToken=null,this._lastTokenExpiry=0,this.emit(o.LOGGED_OUT,null)};this._disconnect(c.LOG_OUT).then(e,e)}_disconnect(e){if(!this._connectCalled)return Promise.resolve(!1);this._connectCalled=!1,this._authenticateCalled=!1;const t=this.isConnected()?o.BEFORE_ONLINE_DISCONNECT:o.BEFORE_OFFLINE_DISCONNECT,n=[];return this.emitSync(t,{awaitPromise:e=>{n.push(e.catch(()=>{}))}}),Promise.all(n).then(()=>this._performDisconnect(e))}isConnected(){return!!(this._stateMask&re)}isAuthenticated(){return!!(this._stateMask&ie)}isReconnecting(){return this._isReconnecting}isOnline(){return this._connectionObserver.isOnline()}connect(){return this._connectCalled=!0,this._connect()}authenticate(){return this._authenticateCalled=!0,this._authenticate(!0)}disconnect(){return this._disconnect(c.EXPLICIT)}forceDisconnect(){return this._connectCalled?(this._connectCalled=!1,this._authenticateCalled=!1,this._performDisconnect(c.EXPLICIT),Promise.resolve(!0)):Promise.resolve(!1)}forceTokenRefresh(){return this._refreshToken(!0).then(()=>!0)}getInitTime(){return this._initTime}getEndpoints(){return this._endpoints?Object.assign({},this._endpoints):null}getLastToken(){return this._lastToken}toPublic(e){return new X(this,e)}hasOwnerRef(e){return this._ownerRef===e}appendTokenQuery(e){return this._refreshToken().then(t=>oe(e,t))}appendLastTokenQuery(e){return this._lastToken?oe(e,this._lastToken):e}matchMessages(e,t,n){if(!e)throw new TypeError('Message "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");const r=r=>{const i=r.data.message;!i.uri||!i.uri.match(e)||n&&n!==r.data.plugin||t(i)};r.__matchMessagesExp=e,r.__matchMessagesPlugin=n,t.__matchMessagesWrapper=r,this._pluginMediator.on(a.PLUGIN_MESSAGE,r)}unmatchMessages(e,t,n){if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");const r=t.__matchMessagesWrapper;return!(!r||r.__matchMessagesExp!==e||r.__matchMessagesPlugin!==n)&&(this._pluginMediator.removeListener(a.PLUGIN_MESSAGE,r),!0)}handlePushRequests(e,t,n){if(!e)throw new TypeError('Push request "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");const r=r=>{const i=r.data.request;!i.message_ident||!i.message_ident.match(e)||n&&n!==r.data.plugin||Promise.resolve(t(i)).then(r.data.reply)};r.__matchRequestExp=e,r.__matchRequestPlugin=n,t.__matchRequestWrapper=r,this._pluginMediator.on(a.PLUGIN_REQUEST,r)}unhandlePushRequests(e,t,n){if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");const r=t.__matchRequestWrapper;return!(!r||r.__matchRequestExp!==e||r.__matchRequestPlugin!==n)&&(this._pluginMediator.removeListener(a.PLUGIN_REQUEST,r),!0)}request(e,t){var n;const r={uri:e,options:t,context:{}};this._pluginMediator.emitSync(a.TRANSPORT_BEFORE_PROCESS_REQUEST,r);const i=this._sendRequest.bind(this,r.uri,r.options,r.context);if(!this._endpoints&&Z.test(r.uri))return J.info("Request queued until endpoints resolved",r.uri),new Promise((e,t)=>{this.once(o.ENDPOINTS_RESOLVED,()=>{J.info("Sending endpoints-queued request",r.uri),i().then(e,t)})});return!this._connectionObserver.isOnline()&&!(null===(n=r.options)||void 0===n?void 0:n.allowOffline)?(J.info("Request queued until online",r.uri),new Promise((e,t)=>{this.once(o.CONNECTION_ONLINE,()=>{J.info("Sending offline-queued request",r.uri),i().then(e,t)})})):i()}addPlugin(e,t){const n=e(this,t),r=n.name;if(this._plugins[r])throw new TypeError("Plugin is already added.");return n.attach(this,this._pluginMediator),this._plugins[r]=n,r}removePlugin(e){const t=this._plugins[e];return!!t&&(t.detach(this,this._pluginMediator),this._plugins[e]=void 0,!0)}hasPlugin(e){return!!this._plugins[e]}getPluginAPI(e){const t=this._plugins[e];return t&&t.api?t.api:null}getConnectionId(e="dealer"){const t=this._plugins[e];return t?t.api&&function(e){return"getConnectionInfo"in e.api}(t)?t.api.getConnectionInfo().then(e=>e.id):Promise.reject(new TypeError(`Plugin ${t} is not a socket plugin.`)):Promise.reject(new TypeError(`Cannot retrieve connection id for plugin ${t}.`))}removeAllListeners(){return this}}class ae{constructor(e){this._headers={},this._init(e)}_init(e){if(e){const t=e.split("\r\n");for(const e of t){const t=e.indexOf(": ");if(t>0){const n=e.substring(0,t).toLowerCase(),r=e.substring(t+2);this._headers[n]=r}}}}get(e){return this._headers[e.toLowerCase()]||null}has(e){return this._headers.hasOwnProperty(e.toLowerCase())}}const ce=R.forTag("transport.http.xhr"),ue=function(){},le={json:!0,text:!0,document:!0};function he(){this.onabort=ue,this.onerror=ue,this.onload=ue,this.onloadend=ue}function de(e,t,n){var r,i;if(null===(r=e.options.signal)||void 0===r?void 0:r.aborted)return;const o=Date.now(),s=this.status,a=new A(this.responseURL||e.url,s);a.body=null;const c=e.options;if(c.timing&&(a.timing={completed:o-t}),(null===(i=c.connectionObserver)||void 0===i?void 0:i.isOnline)&&(a.offline=!c.connectionObserver.isOnline()),(c.parseResponseHeaders||s>299)&&(a.headers=new ae(this.getAllResponseHeaders())),!c.ignoreResponseBody&&s!==w.NO_CONTENT){const e=c.responseType||"";if(!c.forcePolyfill&&"response"in this&&e===this.responseType)a.body=this.response;else if("document"===e)a.body=this.responseXML;else if("json"===e)try{a.body=JSON.parse(this.responseText)}catch(e){ce.warn("Could not parse response as JSON:",e),a.body=null}else"text"!==e&&""!==e||(a.body=this.responseText)}n(a)}function _e(e,t,n){4===this.readyState?t(new A(this.responseURL||e,this.status)):n(new C(i.HTTP_REQUEST_FAILED,"Request cannot be completed.",this.status))}function fe(e){const t=e.options.signal;return new Promise((n,r)=>{if(null==t?void 0:t.aborted)return void r(new P);const i=new XMLHttpRequest;let o=e.url;if(!o)return void r(new TypeError("Request URL cannot be blank."));let s=null;const a=e.method||"GET",c=e.payload||"";a in y&&c?s=c:c&&(o+="?"+c),i.open(a,o,!0),i.onerror=_e.bind(i,o,n,r),i.onabort=he,i.onloadend=he,i.onprogress=ue;const u=e.options;"include"===u.credentials&&(i.withCredentials=!0);const l=u.responseType;if(l)if(u.forcePolyfill){if(!(l in le))return void r(new TypeError(`Cannot polyfill responseType "${l}"`))}else{if(!("responseType"in i)&&!(l in le))return void r(new TypeError("Cannot set responseType: not supported in browser."));try{i.responseType=l}catch(e){return void r(new TypeError(`Unknown responseType "${l}".`))}if(i&&l!==i.responseType&&!(l in le))return void r(new TypeError(`Unknown responseType "${l}".`))}const h=e.headers.count()?e.headers.toJSON():null;if(h)for(const e in h)if(h.hasOwnProperty(e)&&h[e])try{i.setRequestHeader(e,h[e])}catch(e){return void r(e)}t&&t.addEventListener("abort",(function e(){t.removeEventListener("abort",e),i.abort(),r(new P)})),i.onload=de.bind(i,e,Date.now(),n);try{i.send(s)}catch(e){return void r(e)}})}function pe(e){return fe(e)}class Ee extends Error{constructor(e,t,n=-1){super(t),this.name="XResolveError",this.message=t,this.code=e,this.status=n}}const Te="dealer",Oe="spclient",ge={spclient:"spclient.wg.spotify.com",exp:"exp.wg.spotify.com",partners:"partners.wg.spotify.com"};function me(e={}){const t=e.dealer||Te,n=e.webgate||Oe,r=`https://apresolve.spotify.com/?type=${t}&type=${n}`;return function(e){return e.request(r,{forcePolyfill:!0,responseType:"json",retry:{maxRetries:3,curve:"exponential",condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}},metadata:{noRequestTransform:!0}}).then(e=>{var r,o,s,a,c;const u=e.body,l={dealer:null!==(o=null===(r=null==u?void 0:u[t])||void 0===r?void 0:r[0])&&void 0!==o?o:"dealer.spotify.com",webgate:null!==(c=null!==(a=null===(s=null==u?void 0:u[n])||void 0===s?void 0:s[0])&&void 0!==a?a:ge[n])&&void 0!==c?c:ge.spclient,webapi:"https://api.spotify.com/"};if(!l.dealer||!l.webgate)throw new Ee(i.XRESOLVE_INCOMPLETE_RESPONSE,"X-Resolve responded with incomplete results.",e.status);return l}).then(e=>(e.dealer="wss://"+e.dealer.replace(/:443$/,""),e.webgate="https://"+e.webgate.replace(/:443$/,""),e))}}function ve(e){const t=Object.assign({},e);return t.XHR||(t.XHR=u),t.Fetch=r,se.create(t)}function Ne(e){const t=ve(e);return t.addPlugin(b,{WebSocket:WebSocket}),t}},3747:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventSenderReporter=void 0;const o=n(4346),s=n(4323),a=n(4324),c=i(n(3414)),u=n(3419),l=n(4325);function h(e){return t=>e.isAuthenticated()?s.createSemanticMetricClient(t):a.createSemanticMetricClientNonAuth(t)}class d{constructor(e,t,n="browser",r){this.eventSender=e,this.createEvent=t,this.environment=n,this.transport=r}static create(e){const t="getToken"in e?e.getToken:null,n="ownerProvider"in e?e.ownerProvider:null,i=e.context?[...e.context]:void 0,s=e.environment,a=u.createBaseTransport({providers:{endpoints:(()=>{const t=u.createXResolveProvider();return n=>r(this,void 0,void 0,(function*(){const r=yield t(n);return Object.assign(Object.assign({},r),e.internal&&{webgate:l.INTERNAL_WEBGATE_URL})}))})(),token:()=>new Promise(e=>{t?t((t,n)=>{e(void 0===n?t:[t,n])}):e("")})}});t&&(a.on(u.TransportEvent.CONNECTED,()=>{a.authenticate().catch(e=>{var t,n;c.default.debug("authentication fail.",null!==(n=null!==(t=null==e?void 0:e.message)&&void 0!==t?t:null==e?void 0:e.code)&&void 0!==n?n:"")})}),a.on(u.TransportEvent.AUTHENTICATED,()=>{c.default.debug("created authenticated browser transport")}),a.on(u.TransportEvent.TOKEN_PROVIDER_ERROR,()=>{c.default.debug("the token provided isn't working.")})),a.connect();const _=o.createEventSender(Object.assign({transport:a,context:i},n&&{ownerProvider:n})),f=h(a);return new d(_,f,s,a)}static createWithCustomTransport(e){const t="ownerProvider"in e?e.ownerProvider:null,n=e.context?[...e.context]:void 0,r=o.createEventSender(Object.assign({transport:e.transport,context:n},t&&{ownerProvider:t})),i=h(e.transport);return new d(r,i,e.environment,e.transport)}send(e){return r(this,void 0,void 0,(function*(){for(const t of e){const e=Object.assign({},t);e.tags=Object.assign({},e.tags),e.tags.environment&&c.default.error("`tags.environment` must not be set. It is a reserved tag and will be overwritten."),e.tags.environment=this.environment;const n=this.createEvent(Object.assign({},e));this.eventSender.send(n,{flush:!1})}return this.eventSender.flush(this.transport.isAuthenticated())}))}}t.EventSenderReporter=d},3748:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(3277);class i extends Error{constructor(e=r.a.DEALER_ERROR,t,n={}){super(t),this.name="DealerError",this.message=t,this.code=e,this.raw=n,this.wsCode=n.code||null,this.wsReason=n.reason||null}}},3749:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.CONNECTED="connected",e.CONNECTION_ID="connection_id",e.ERROR="error",e.DISCONNECTED="disconnected",e.MESSAGE="message",e.REQUEST="request"}(r||(r={}))},3750:function(e,t,n){"use strict";function r(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}n.d(t,"a",(function(){return r}))},3751:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.CLOSE=4e3]="CLOSE",e[e.TIMEOUT=4001]="TIMEOUT"}(r||(r={}))},3752:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"intercept",(function(){return u})),n.d(t,"unintercept",(function(){return l})),n.d(t,"list",(function(){return h})),n.d(t,"enable",(function(){return d})),n.d(t,"disable",(function(){return _})),n.d(t,"setLevel",(function(){return f})),n.d(t,"enableAll",(function(){return p})),n.d(t,"disableAll",(function(){return E})),n.d(t,"forTag",(function(){return T})),n.d(t,"remove",(function(){return O}));var r=n(4315);let i=e.__dbgLoggerRegistry;i||(i={map:{},list:[],loggingPredicate:function(){}},Object.defineProperty?Object.defineProperty(e,"__dbgLoggerRegistry",{value:i}):e.__dbgLoggerRegistry=i);const o=i.map,s=i.list;function a(e){return!(!i.loggingPredicate||!i.loggingPredicate(e))}let c="log";function u(e){if("function"!=typeof e)throw new TypeError("Logging.intercept requires a function predicate.");i.loggingPredicate=e}function l(){i.loggingPredicate=()=>{}}function h(e){const t=Object.keys(o).filter(e=>o[e]).sort();return e?t.map(e=>({tag:e,description:o[e].description||"No description."})):t.reduce((e,t)=>(e[t]=o[t].description||"No description",e),{})}function d(e){var t;const n=Array.isArray(e)?e:[e];let r=n.length;for(;r--;){const e=null===(t=n[r])||void 0===t?void 0:t.toLowerCase();let i=s.length;for(;i--;){const t=s[i];t.matchesTag(e)&&t.enable()}}}function _(e){var t;const n=Array.isArray(e)?e:[e];let r=n.length;for(;r--;){const e=null===(t=n[r])||void 0===t?void 0:t.toLowerCase();let i=s.length;for(;i--;){const t=s[i];t.matchesTag(e)&&t.disable()}}}function f(e){c=e;let t=s.length;for(;t--;){const n=s[t];n&&n.setLevel(e)}}function p(){let e=s.length;for(;e--;)s[e]&&s[e].enable()}function E(){let e=s.length;for(;e--;)s[e]&&s[e].disable()}function T(e,t){let n,i;if("string"==typeof e?(n=e.toLowerCase(),i=t):(n=e.tag,i=e.description),o.hasOwnProperty(n)&&o[n])return o[n];const u=new r.a(n,i,a);return u.setLevel(c),o[n]=u,s.push(u),u}function O(e){const t=e.toLowerCase();if(!o.hasOwnProperty(t)||!o[t])return;const n=o[t];o[t]=null;const r=s.indexOf(n);-1!==r&&s.splice(r,1)}}.call(this,n(62))},3753:function(e,t,n){"use strict";(function(e,t){}).call(this,n(85),n(62))},3754:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"intercept",(function(){return u})),n.d(t,"unintercept",(function(){return l})),n.d(t,"list",(function(){return h})),n.d(t,"enable",(function(){return d})),n.d(t,"disable",(function(){return _})),n.d(t,"setLevel",(function(){return f})),n.d(t,"enableAll",(function(){return p})),n.d(t,"disableAll",(function(){return E})),n.d(t,"forTag",(function(){return T})),n.d(t,"remove",(function(){return O}));var r=n(4318);let i=e.__dbgLoggerRegistry;i||(i={map:{},list:[],loggingPredicate:function(){}},Object.defineProperty?Object.defineProperty(e,"__dbgLoggerRegistry",{value:i}):e.__dbgLoggerRegistry=i);const o=i.map,s=i.list;function a(e){return!(!i.loggingPredicate||!i.loggingPredicate(e))}let c="log";function u(e){if("function"!=typeof e)throw new TypeError("Logging.intercept requires a function predicate.");i.loggingPredicate=e}function l(){i.loggingPredicate=()=>{}}function h(e){const t=Object.keys(o).filter(e=>o[e]).sort();return e?t.map(e=>({tag:e,description:o[e].description||"No description."})):t.reduce((e,t)=>(e[t]=o[t].description||"No description",e),{})}function d(e){var t;const n=Array.isArray(e)?e:[e];let r=n.length;for(;r--;){const e=null===(t=n[r])||void 0===t?void 0:t.toLowerCase();let i=s.length;for(;i--;){const t=s[i];t.matchesTag(e)&&t.enable()}}}function _(e){var t;const n=Array.isArray(e)?e:[e];let r=n.length;for(;r--;){const e=null===(t=n[r])||void 0===t?void 0:t.toLowerCase();let i=s.length;for(;i--;){const t=s[i];t.matchesTag(e)&&t.disable()}}}function f(e){c=e;let t=s.length;for(;t--;){const n=s[t];n&&n.setLevel(e)}}function p(){let e=s.length;for(;e--;)s[e]&&s[e].enable()}function E(){let e=s.length;for(;e--;)s[e]&&s[e].disable()}function T(e,t){let n,i;if("string"==typeof e?(n=e.toLowerCase(),i=t):(n=e.tag,i=e.description),o.hasOwnProperty(n)&&o[n])return o[n];const u=new r.a(n,i,a);return u.setLevel(c),o[n]=u,s.push(u),u}function O(e){const t=e.toLowerCase();if(!o.hasOwnProperty(t)||!o[t])return;const n=o[t];o[t]=null;const r=s.indexOf(n);-1!==r&&s.splice(r,1)}}.call(this,n(62))},3755:function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return i})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__esDecorate",(function(){return u})),n.d(t,"__runInitializers",(function(){return l})),n.d(t,"__propKey",(function(){return h})),n.d(t,"__setFunctionName",(function(){return d})),n.d(t,"__metadata",(function(){return _})),n.d(t,"__awaiter",(function(){return f})),n.d(t,"__generator",(function(){return p})),n.d(t,"__createBinding",(function(){return E})),n.d(t,"__exportStar",(function(){return T})),n.d(t,"__values",(function(){return O})),n.d(t,"__read",(function(){return g})),n.d(t,"__spread",(function(){return m})),n.d(t,"__spreadArrays",(function(){return v})),n.d(t,"__spreadArray",(function(){return N})),n.d(t,"__await",(function(){return b})),n.d(t,"__asyncGenerator",(function(){return R})),n.d(t,"__asyncDelegator",(function(){return y})),n.d(t,"__asyncValues",(function(){return w})),n.d(t,"__makeTemplateObject",(function(){return C})),n.d(t,"__importStar",(function(){return I})),n.d(t,"__importDefault",(function(){return A})),n.d(t,"__classPrivateFieldGet",(function(){return S})),n.d(t,"__classPrivateFieldSet",(function(){return D})),n.d(t,"__classPrivateFieldIn",(function(){return L}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t,n,r,i,o){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=r.kind,u="getter"===c?"get":"setter"===c?"set":"value",l=!t&&e?r.static?e:e.prototype:null,h=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d=!1,_=n.length-1;_>=0;_--){var f={};for(var p in r)f[p]="access"===p?{}:r[p];for(var p in r.access)f.access[p]=r.access[p];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(e||null))};var E=(0,n[_])("accessor"===c?{get:h.get,set:h.set}:h[u],f);if("accessor"===c){if(void 0===E)continue;if(null===E||"object"!=typeof E)throw new TypeError("Object expected");(a=s(E.get))&&(h.get=a),(a=s(E.set))&&(h.set=a),(a=s(E.init))&&i.push(a)}else(a=s(E))&&("field"===c?i.push(a):h[u]=a)}l&&Object.defineProperty(l,r.name,h),d=!0}function l(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0}function h(e){return"symbol"==typeof e?e:"".concat(e)}function d(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function _(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function p(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var E=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function T(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||E(t,e,n)}function O(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function N(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function R(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof b?Promise.resolve(n.value.v).then(c,u):l(o[0][2],n)}catch(e){l(o[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function y(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:b(e[r](t)),done:!1}:i?i(t):t}:i}}function w(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=O(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function C(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&E(t,e,n);return P(t,e),t}function A(e){return e&&e.__esModule?e:{default:e}}function S(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function D(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function L(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},3756:function(e,t,n){"use strict";n.r(t),n.d(t,"Base62",(function(){return r})),n.d(t,"Base64",(function(){return i}));var r={};n.r(r),n.d(r,"fromBytes",(function(){return _})),n.d(r,"toBytes",(function(){return f})),n.d(r,"toHex",(function(){return p})),n.d(r,"fromHex",(function(){return E}));var i={};n.r(i),n.d(i,"encode",(function(){return g})),n.d(i,"decode",(function(){return m}));const o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s={},a={};function c(e,t,n){let r=0;for(let i=0;i<e.length;++i){const o=e[i]*t+r;e[i]=o%n,r=~~(o/n)}for(;r;)e.push(r%n),r=~~(r/n)}function u(e,t,n,r){let i,o,s=0;for(o=0;o<t.length;++o)i=~~e[o]+t[o]*n+s,e[o]=i%r,s=~~(i/r);for(;s;)i=~~e[o]+s,e[o]=i%r,s=~~(i/r),++o}function l(e,t,n){const r=[0],i=[1];for(const o of e)u(r,i,o,n),c(i,t,n);return r}function h(e,t){const n=[];for(const r of e)n.push(t[r]);return n.reverse()}function d(e,t=0){for(;e.length<t;)e.push(0);return e}function _(e,t){return h(d(l(e.slice(0).reverse(),256,62),t),o).join("")}function f(e,t){return d(l(h(e.split(""),a),62,256),t).reverse()}function p(e,t){const n=l(h(e.split(""),a),62,16);return h(d(n,t),o).join("")}function E(e,t){const n=l(h(e.split(""),s),16,62);return h(d(n,t),o).join("")}!function(){for(let e=0,t=o.length;e<t;++e)a[o[e]]=e;for(let e=0;e<16;++e)s["0123456789abcdef"[e]]=e;for(let e=0;e<16;++e)s["0123456789ABCDEF"[e]]=e}();const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=(()=>{const e=[];for(let t=0;t<256;++t)e[t]=255;for(let t=0;t<T.length;++t)e[T.charCodeAt(t)]=t;return String.fromCharCode(...e)})();let g=function(e){const t=String(e),n=[],r=t.length;let i=0;for(;i<r;){const e=255&t.charCodeAt(i++);if(i===r){n.push(T.charAt(e>>2),T.charAt((3&e)<<4),"==");break}const o=t.charCodeAt(i++);if(i===r){n.push(T.charAt(e>>2),T.charAt((3&e)<<4|(240&o)>>4),T.charAt((15&o)<<2),"=");break}const s=t.charCodeAt(i++);n.push(T.charAt(e>>2),T.charAt((3&e)<<4|(240&o)>>4),T.charAt((15&o)<<2|(192&s)>>6),T.charAt(63&s))}return n.join("")},m=function(e){const t=String(e),n=[],r=t.length;let i,o,s=0;for(;;){do{i=O.charCodeAt(255&t.charCodeAt(s++))}while(255===i&&s<r);do{o=O.charCodeAt(255&t.charCodeAt(s++))}while(255===o&&s<r);if(255===o)break;n.push(255&(i<<2|o>>4));do{i=O.charCodeAt(255&t.charCodeAt(s++))}while(255===i&&s<r);if(255===i)break;n.push(255&(o<<4|i>>2));do{o=O.charCodeAt(255&t.charCodeAt(s++))}while(255===o&&s<r);if(255===o)break;n.push(255&(i<<6|o))}return function(e){if(e.length<4096)return String.fromCharCode(...e);let t=0;const n=[];do{n.push(String.fromCharCode(...e.slice(t,t+4096))),t+=4096}while(t<e.length);return n.join("")}(n)};"undefined"!=typeof window&&window.btoa&&window.atob&&(g=e=>window.btoa(e),m=e=>window.atob(e))},4309:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Time=t.Timer=void 0,i(n(3276),t),i(n(4312),t),i(n(3747),t),i(n(4326),t);var o=n(4327);Object.defineProperty(t,"Timer",{enumerable:!0,get:function(){return o.Timer}});var s=n(3415);Object.defineProperty(t,"Time",{enumerable:!0,get:function(){return s.Time}})},4310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.silly=t.verbose=t.debug=t.info=t.warn=t.error=t.log=t.logger=void 0,t.logger={log:(...e)=>console.log(...e),error:(...e)=>console.error(...e),warn:(...e)=>console.warn(...e),info:(...e)=>console.info(...e),debug:(...e)=>console.debug(...e),verbose:(...e)=>console.log("verbose:",...e),silly:(...e)=>console.log("silly:",...e)},t.default=t.logger,t.log=t.logger.log.bind(t.logger),t.error=t.logger.error.bind(t.logger),t.warn=t.logger.warn.bind(t.logger),t.info=t.logger.info.bind(t.logger),t.debug=t.logger.debug.bind(t.logger),t.verbose=t.logger.verbose.bind(t.logger),t.silly=t.logger.silly.bind(t.logger)},4311:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.NoopReporter=void 0;t.NoopReporter=class{send(e){return r(this,void 0,void 0,(function*(){}))}}},4312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4313:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));const r="undefined"!=typeof window,i=[];function o(){var e;const t=i.splice(0);if(t.length)for(let n=0,r=t.length;n<r;n++)try{null===(e=t[n])||void 0===e||e.call(t)}finally{}}let s;r&&"function"==typeof window.postMessage?function(){const e=window.location.origin||`${window.location.protocol}//${window.location.hostname}`;if(s=window.postMessage.bind(window,"@execute_deferreds",e),!window.__hasDeferredHandler){"function"==typeof Object.defineProperty?Object.defineProperty(window,"__hasDeferredHandler",{value:!0}):window.__hasDeferredHandler=!0;const t=function(t){t.origin!==e&&"@execute_deferreds"!==t.data||o()};window.addEventListener?window.addEventListener("message",t):window.attachEvent&&window.attachEvent("onmessage",t)}}():s="function"==typeof queueMicrotask?queueMicrotask.bind(null,o):"function"==typeof e?e.bind(null,o):setTimeout.bind(null,o,10);let a=e=>{const t=!i.length;i.push(e),t&&s()};r&&("function"==typeof window.__modDefFn?a=window.__modDefFn:"function"==typeof Object.defineProperty?Object.defineProperty(window,"__modDefFn",{value:a}):window.__modDefFn=a)}).call(this,n(796).setImmediate)},4314:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var r=n(3172),i=n(3750),o=n(3277),s=n(3751),a=n(3748),c=n(3749);const u=function(){},l=/hm:\/\/pusher\/(?:[^]+)?\/connections\/([^]+)/,h="undefined"!=typeof window;class d extends r.a{constructor(e){super(),this._socket=null,this._lastPingDeferred=null,this._waitingForConnectionId=!0,this._connectionId=null,this._connectionURI=null,this._heartbeatToken=0,this._heartbeatTimeoutToken=0,this._connected=!1,this._endpoint=null,this._WebSocket=e.WebSocket||WebSocket,this._heartbeatTimeout=e.heartbeatTimeout||1e4}static create(e){return new d(e)}_startHeartbeat(e){const t=()=>{this.ping().then(()=>this._onHeartbeatSuccess(),()=>this._onHeartbeatError()),this._heartbeatTimeoutToken=setTimeout(()=>this._onHeartbeatError(),this._heartbeatTimeout)};e?t():this._heartbeatToken=setTimeout(()=>t(),3e4)}_onHeartbeatError(){this._stopHeartbeat(),this._socket&&this._socket.close(s.a.TIMEOUT,"internal-timeout")}_onHeartbeatSuccess(){this._stopHeartbeat(),this._startHeartbeat()}_stopHeartbeat(){null!==this._heartbeatToken&&clearTimeout(this._heartbeatToken),null!==this._heartbeatTimeoutToken&&clearTimeout(this._heartbeatTimeoutToken)}_prepareConnectionId(e){var t;if(!e.uri)return!1;const[,n]=null!==(t=e.uri.match(l))&&void 0!==t?t:[];if(!n)return!1;let r;return r=e.headers&&e.headers["Spotify-Connection-Id"]?e.headers["Spotify-Connection-Id"]:decodeURIComponent(n),this._connectionId=r,this._connectionURI=e.uri,this.emit(c.a.CONNECTION_ID,{id:r,uri:e.uri}),!0}_reply(e,t){if(!e)throw new TypeError("Invalid key.");const n=this._socket;if(!n||1!==n.readyState)return;const r={type:"reply",key:e,payload:t};n.send(JSON.stringify(r))}_parseMessage(e){let t;try{t=JSON.parse(e)}catch(e){return}if("message"===t.type)this._waitingForConnectionId&&this._prepareConnectionId(t)?(this._waitingForConnectionId=!1,this._startHeartbeat(!0)):this.emit(c.a.MESSAGE,{message:t});else if("pong"===t.type&&this._lastPingDeferred)this._lastPingDeferred.resolve(!0),this._lastPingDeferred=null;else if("request"===t.type){const e=t.key;e&&this.emit(c.a.REQUEST,{request:t,reply:this._reply.bind(this,e)})}}_handleOpen(e){e.resolve(!0),this._connected=!0,this.emit(c.a.AUTHENTICATED,null)}_handleMessage(t){const n=this,r=t.data;if(h&&window.Blob&&r instanceof window.Blob){const e=new FileReader;e.onloadend=function(){if(!this.result)return;let e;if(this.result instanceof ArrayBuffer){e="";const t=new Uint8Array(this.result);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n])}else e=this.result;n._parseMessage(e)},e.readAsText(r)}else void 0!==e&&"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?this._parseMessage(new e(r).toString("ascii")):this._parseMessage(r)}_handleClose(e){const t=this._connected;if(this._connected=!1,t)this.emitSync(c.a.DISCONNECTED,{wsCode:e.code,reason:e.reason});else{const t=new a.a(o.a.DEALER_AUTHENTICATION_FAILED,"Dealer connection error",e);this.emit(c.a.AUTHENTICATION_FAILED,{error:t})}}_handleError(e){const t=new a.a(o.a.DEALER_CONNECTION_ERROR,"Cannot connect to dealer");e.reject(t),this._connected=!1,this.emit(c.a.ERROR,{error:t})}connect(e){return this._endpoint=e,this._waitingForConnectionId=!0,this.emit(c.a.CONNECTED,null),Promise.resolve(!0)}authenticate(e){const t=Object(i.a)(),n=`${this._endpoint}?access_token=${e}`,r=this._socket=new this._WebSocket(n);return r.onopen=this._handleOpen.bind(this,t),r.onclose=this._handleClose.bind(this),r.onerror=this._handleError.bind(this,t),r.onmessage=this._handleMessage.bind(this),t.promise}disconnect(){this._socket&&(this._stopHeartbeat(),this._waitingForConnectionId=!0,this._connected=!1,this._socket.close(s.a.CLOSE,"internal-close"),this._socket.onopen=u,this._socket.onerror=u,this._socket.onmessage=u,this._socket.onclose=u,this._socket=null,this.emitSync(c.a.DISCONNECTED,{wsCode:s.a.CLOSE,reason:"internal-close"}))}ping(){return this._socket&&1===this._socket.readyState?(this._lastPingDeferred=Object(i.a)(),this._socket.send('{"type":"ping"}'),this._lastPingDeferred.promise):Promise.reject(new a.a(o.a.DEALER_CONNECTION_ERROR,"Dealer connection error"))}getConnectionId(){return this._waitingForConnectionId?new Promise(e=>{this.once(c.a.CONNECTION_ID,t=>{e(t.data.id)})}):Promise.resolve(this._connectionId)}getConnectionInfo(){return this._waitingForConnectionId?new Promise(e=>{this.once(c.a.CONNECTION_ID,t=>{e({id:t.data.id,uri:t.data.uri})})}):Promise.resolve({id:this._connectionId,uri:this._connectionURI})}hasConnectionId(){return!this._waitingForConnectionId&&!!this._connectionId}}}).call(this,n(709).Buffer)},4315:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var r=n(4316),i=n(4317);const o=void 0!==e&&"true"===Object({LEGACY_BASE_URL:"https://anchor.fm",WEBSITE_PATH_PREFIX:"/pod"}).DEBUG?class{constructor(e,t="",n=(()=>!1)){this._tagParts=[],this._tagText="",this._enabled=!0,this._level=r.a.NONE,this.tag="",this.description="",this._predicate=function(){return!1},this.tag=e,this.description=t,this._predicate=n,this._tagParts=e.split("."),this._tagText=`[${e}]`}_print(e,t,n){if(!(this._enabled||this._level&t))return;const r={args:n,type:e,tag:this.tag};this._predicate(r)||console[e](this._tagText,...n)}matchesTag(e){const t=Array.isArray(e)?e:e.split("."),n=this._tagParts;if(t.length>n.length)return!1;for(let e=0,r=t.length;e<r;e++)if(("*"!==t[e]||!n[e])&&t[e]!==n[e])return!1;return!0}setLevel(e){let t=0;switch(e){case"error":t=r.a.ERROR;break;case"warn":t=r.a.WARN|r.a.ERROR;break;case"info":t=r.a.INFO|r.a.WARN|r.a.ERROR;break;case"debug":t=r.a.DEBUG|r.a.INFO|r.a.WARN|r.a.ERROR;break;case"log":default:t=r.a.LOG|r.a.DEBUG|r.a.INFO|r.a.WARN|r.a.ERROR}this._level=t}enable(){this._enabled=!0}disable(){this._enabled=!1}log(...e){this._print("log",r.a.LOG,e)}debug(...e){this._print("debug",r.a.DEBUG,e)}info(...e){this._print("info",r.a.INFO,e)}warn(...e){this._print("warn",r.a.WARN,e)}error(...e){this._print("error",r.a.ERROR,e)}}:i.a}).call(this,n(85))},4316:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.DEBUG=2]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=8]="WARN",e[e.ERROR=16]="ERROR"}(r||(r={}))},4317:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(){this.tag="",this.description=""}matchesTag(){return!1}setLevel(){}enable(){}disable(){}log(){}debug(){}info(){}warn(){}error(){}}},4318:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var r=n(4319),i=n(4320);const o=void 0!==e&&"true"===Object({LEGACY_BASE_URL:"https://anchor.fm",WEBSITE_PATH_PREFIX:"/pod"}).DEBUG?class{constructor(e,t="",n=(()=>!1)){this._tagParts=[],this._tagText="",this._enabled=!0,this._level=r.a.NONE,this.tag="",this.description="",this._predicate=function(){return!1},this.tag=e,this.description=t,this._predicate=n,this._tagParts=e.split("."),this._tagText=`[${e}]`}_print(e,t,n){if(!(this._enabled||this._level&t))return;const r={args:n,type:e,tag:this.tag};this._predicate(r)||console[e](this._tagText,...n)}matchesTag(e){const t=Array.isArray(e)?e:e.split("."),n=this._tagParts;if(t.length>n.length)return!1;for(let e=0,r=t.length;e<r;e++)if(("*"!==t[e]||!n[e])&&t[e]!==n[e])return!1;return!0}setLevel(e){let t=0;switch(e){case"error":t=r.a.ERROR;break;case"warn":t=r.a.WARN|r.a.ERROR;break;case"info":t=r.a.INFO|r.a.WARN|r.a.ERROR;break;case"debug":t=r.a.DEBUG|r.a.INFO|r.a.WARN|r.a.ERROR;break;case"log":default:t=r.a.LOG|r.a.DEBUG|r.a.INFO|r.a.WARN|r.a.ERROR}this._level=t}enable(){this._enabled=!0}disable(){this._enabled=!1}log(...e){this._print("log",r.a.LOG,e)}debug(...e){this._print("debug",r.a.DEBUG,e)}info(...e){this._print("info",r.a.INFO,e)}warn(...e){this._print("warn",r.a.WARN,e)}error(...e){this._print("error",r.a.ERROR,e)}}:i.a}).call(this,n(85))},4319:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.DEBUG=2]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=8]="WARN",e[e.ERROR=16]="ERROR"}(r||(r={}))},4320:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(){this.tag="",this.description=""}matchesTag(){return!1}setLevel(){}enable(){}disable(){}log(){}debug(){}info(){}warn(){}error(){}}},4321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRejectedClientEventNonAuth=void 0,t.createRejectedClientEventNonAuth=function(e){return{name:"RejectedClientEventNonAuth",environments:["browsernonauth","desktopnonauth","devicenonauth"],data:e}}},4322:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEventSenderStats2NonAuth=void 0,t.createEventSenderStats2NonAuth=function(e){return{name:"EventSenderStats2NonAuth",environments:["devicenonauth","browsernonauth","desktopnonauth"],data:e}}},4323:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSemanticMetricClient=void 0,t.createSemanticMetricClient=function(e){return{name:"SemanticMetricClient",environments:["browser","device"],data:e}}},4324:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSemanticMetricClientNonAuth=void 0,t.createSemanticMetricClientNonAuth=function(e){return{name:"SemanticMetricClientNonAuth",environments:["browsernonauth","devicenonauth"],data:e}}},4325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEBAPI_URL=t.INTERNAL_WEBGATE_URL=void 0,t.INTERNAL_WEBGATE_URL="https://wgint.spotify.net",t.WEBAPI_URL="https://api.spotify.com"},4326:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleReporter=void 0;const o=i(n(3414));t.ConsoleReporter=class{constructor(e=2,t="info"){this.spacingLevel=e,this.logLevel=t}send(e){return r(this,void 0,void 0,(function*(){o.default.log(this.logLevel,"[semantic-metrics] "+JSON.stringify(e,null,this.spacingLevel))}))}}},4327:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=t.getHighResolutionTime=t.getLowResolutionTime=t.getTime=t.getBrowserTime=t.supportsHighResolutionTime=void 0;const r=n(3415),i=n(3276);t.supportsHighResolutionTime=()=>"undefined"==typeof window&&"function"==typeof e.hrtime;t.getBrowserTime=()=>"undefined"!=typeof performance?performance.now():Date.now();t.getTime=()=>t.supportsHighResolutionTime()?e.hrtime():t.getBrowserTime();t.getLowResolutionTime=e=>{const n=t.getTime()-e,o=r.Time.fromMillis(n);return{nanoseconds:i.asNanoseconds(o.asNanos()),milliseconds:o.asMillis(),seconds:o.asSeconds()}};t.getHighResolutionTime=t=>{const[n,r]=e.hrtime(t),o=1e9*n+r,s=o/1e6,a=o/1e9;return{nanoseconds:i.asNanoseconds(o),milliseconds:s,seconds:a}};class o{constructor(e){this.startTime=e}static start(){return new o(t.getTime())}end(){return t.supportsHighResolutionTime()?t.getHighResolutionTime(this.startTime):t.getLowResolutionTime(this.startTime)}}t.Timer=o}).call(this,n(85))},4328:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUniversalReporter=void 0;const r=n(3747),i=n(4329);t.createUniversalReporter=function(e={}){const t=e.context?[i.createUserAgentContext(),...e.context]:[i.createUserAgentContext()];return r.EventSenderReporter.create(Object.assign(Object.assign({environment:"browser"},e),{context:t}))}},4329:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3755);r.__exportStar(n(4330),t),r.__exportStar(n(4331),t),r.__exportStar(n(4332),t),r.__exportStar(n(4333),t),r.__exportStar(n(4334),t),r.__exportStar(n(4335),t),r.__exportStar(n(4336),t),r.__exportStar(n(4337),t),r.__exportStar(n(4338),t),r.__exportStar(n(4339),t),r.__exportStar(n(4340),t)},4330:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createApplicationContext=void 0,t.createApplicationContext=function(e){return function(){return{name:"context_application",data:e}}}},4331:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createApplicationDesktopContext=void 0,t.createApplicationDesktopContext=function(e){return function(){return{name:"context_application_desktop",data:e}}}},4332:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCacheIdContext=void 0;var r=n(3416);t.createCacheIdContext=function(e){var t=r.hexToBase64(e);return function(){return{name:"context_cache_id",data:{value:t}}}}},4333:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createClientIdContext=void 0;var r=n(3416);t.createClientIdContext=function(e){var t=r.hexToBase64(e);return function(){return{name:"context_client_id",data:{value:t}}}}},4334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createClientIpContext=void 0,t.createClientIpContext=function(e){return function(){return{name:"context_client_ip",data:{value:e}}}}},4335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCorrelationIdContext=void 0,t.createCorrelationIdContext=function(e){return function(){return{name:"context_correlation_id",data:{value:e}}}}},4336:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceContext=void 0,t.createDeviceContext=function(e){return function(){return{name:"context_device",data:e}}}},4337:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceDesktopContext=void 0,t.createDeviceDesktopContext=function(e){return function(){return{name:"context_device_desktop",data:e}}}},4338:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createInstallationIdContext=void 0;var r=n(3416);t.createInstallationIdContext=function(e){var t=r.hexToBase64(e);return function(){return{name:"context_installation_id",data:{value:t}}}}},4339:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOsContext=void 0,t.createOsContext=function(e){return function(){return{name:"context_os",data:e}}}},4340:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUserAgentContext=void 0,t.createUserAgentContext=function(e){if(!e&&"undefined"==typeof navigator)throw new Error("userAgent is not provided and navigator.UserAgent is not available");return function(){return{name:"context_user_agent",data:{value:e||navigator.userAgent}}}}},4341:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserMetrics=void 0;const r=n(3276),i=n(3415);function o(){const[e]=window.performance.getEntriesByType("navigation");return e}function s(e){return new Promise((t,n)=>window.performance&&"function"==typeof performance.getEntriesByType?window.addEventListener("load",()=>{const r=performance.getEntriesByType("paint"),i=r.find(({name:t})=>t===e);return void 0!==r&&i?t(i.startTime):n("Time to paint api is not supported on this browser")}):n("window.performance api is not supported in this browser"))}function a({name:e,label:t,value:n},r){let o;return o="cls"===e.toLowerCase()?{metric_type:"gauge",value:n}:{metric_type:"timer",value:i.Time.fromMillis(Math.round(n)).asNanos()},Object.assign(Object.assign({what:"web_vitals_"+e.toLowerCase()},o),{tags:Object.assign({name:e,label:t},r)})}const c={getPageLoadTime:function(){return new Promise((e,t)=>{if(!window.performance||"function"!=typeof performance.getEntriesByType)return t("window.performance api is not supported in this browser");if(void 0===o())return t("navigationTiming api is not supported in this browser");const{loadEventEnd:n}=o();return n>0?e(n):window.addEventListener("load",()=>{setTimeout(()=>{const{loadEventEnd:t}=o();return e(t)},0)})})},getResourceTiming:function(){return window.performance.getEntriesByType("resource")},getTimeToFirstPaint:function(){return s("first-paint")},getTimeToFirstContentfulPaint:function(){return s("first-contentful-paint")},sendWebVitalsMetric:function(e,t){return r.sendMetric(a(e,t))},getWebVitalsMetric:a};t.BrowserMetrics=c},4346:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"Environment",(function(){return r})),n.d(t,"EventSenderEvent",(function(){return i})),n.d(t,"createEventSender",(function(){return D})),function(e){e.BACKEND="BACKEND",e.BROWSER="BROWSER",e.BROWSER_NON_AUTH="BROWSER_NON_AUTH",e.DESKTOP="DESKTOP",e.DESKTOP_NON_AUTH="DESKTOP_NON_AUTH",e.DEVICE="DEVICE",e.DEVICE_NON_AUTH="DEVICE_NON_AUTH"}(r||(r={}));var i,o=n(3755),s=n(3419),a=(n(3753),n(3754)),c=n(3172);!function(e){e.UPLOAD_SUCCEEDED="upload_succeeded",e.UPLOAD_FAILED="upload_failed",e.UPLOAD_REQUEST_FAILED="upload_request_failed"}(i||(i={}));const u=a.forTag("Uploader");function l(e,t){const{event_name:n,fragments:r}=e,{message:i}=r;return{reason:t,contexts:Object(o.__rest)(r,["message"]),event_data:{name:n,data:i}}}class h extends c.a{constructor(e){var t;super(),this._suppressPersist=!1,this._backoff=!1,this._authorize=null===(t=e.authorize)||void 0===t||t,this._transport=e.transport,this._suppressPersist=!!e.suppressPersist,this._endpoint=this._authorize?"@webgate/gabo-receiver-service/v3/events":"@webgate/gabo-receiver-service/public/v3/events"}_uploadBatch(e,t=!1){const n=this._transport,r=t&&this._authorize?n.appendLastTokenQuery(this._endpoint):this._endpoint;return this._transport.request(r,{method:s.Method.POST,metadata:{eventSenderEventNames:e.map(e=>e.event_name)},headers:{"content-type":"application/json"},responseType:"json",parseResponseHeaders:!0,payload:JSON.stringify({suppress_persist:this._suppressPersist,events:e}),forget:t,authorize:!t&&this._authorize}).then(this._parseUploadResponse.bind(this,e,t))}_parseUploadResponse(e,t,n){if(t)return Promise.resolve([]);const{body:r,headers:o,status:s}=n,a=this._authorize;if(200!==s||!r)return u.warn("Upload request failed",n),this.emit(i.UPLOAD_REQUEST_FAILED,{authorize:a,status:s}),this._backoff=!0,Promise.resolve(e);const c=[],h=[],d=[];if(r.error&&r.error.length){u.info("response errors",e,r.error);for(let t=0,n=r.error.length;t<n;t++){const{transient:n,index:i,reason:o}=r.error[t],s=l(e[i],o);n?(c.push(e[i]),h.push(s)):d.push(s)}}this._backoff=!("true"!==(null==o?void 0:o.get("backoff")));const _=h.length+d.length,f=e.length-_;return _>0&&this.emit(i.UPLOAD_FAILED,{authorize:a,rejected:d,will_retry:h}),f>0&&this.emit(i.UPLOAD_SUCCEEDED,{authorize:this._authorize,num_events:f}),Promise.resolve(c)}upload(e,t=[]){let n=t;if(!e.length)return Promise.resolve({nack:n,backoff:this._backoff});const r=[...e];return this._uploadBatch(r.splice(0,20)).then(e=>{if(n=[...n,...e],this._backoff)n=[...n,...r];else if(r.length)return this.upload(r,n);return{nack:n,backoff:this._backoff}})}lastUpload(e){return e.length?this._uploadBatch(e.splice(0,100),!0).then(e=>0===e.length,()=>!1):Promise.resolve(!0)}shouldBackoff(){return this._backoff}}function d(e){return new h(e)}function _(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;const f=200,p=0,E="linear",T=!0;class O{constructor(e={}){this._curve=e.curve||E,this._baseTime=e.baseTime||f,this._ceiling=e.ceiling||p,this._jitter="jitter"in e?!!e.jitter:T}getTime(e){let t;switch(this._curve){case"static":t=1;break;case"logarithmic":t=Math.log(e);break;case"exponential":t=Math.pow(Math.E,e);break;case"linear":default:t=e+1}let n=Math.min(4294967296,Math.floor(t*this._baseTime));return this._ceiling&&(n=Math.min(n,this._ceiling)),this._jitter?function(e){const t=e/5;return Math.floor(e-t/2+Math.random()*t)}(n):n}}const g={backoffInitial:!1,baseTime:200,ceiling:0,curve:"linear",jitter:!0,maxDuration:1/0,maxRetries:1/0,maxTime:1/0,retryPredicate:()=>!0};class m{constructor(e,t){this._resolver=function(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}(),this._ts=0,this._callCount=0,this._tickInterval=0,this._isRunning=!1,this._isDestroyed=!1;const n=Object.assign(Object.assign({},g),t),{backoffInitial:r,maxDuration:i,maxRetries:o,maxTime:s,retryPredicate:a}=n,c=_(n,["backoffInitial","maxDuration","maxRetries","maxTime","retryPredicate"]);this._fn=e,this._backoffInitial=r,this._maxDuration=i,this._maxRetries=o,this._maxTime=s,this._retryPredicate=a,this._backoffInitial=r,this._counter=new O(c),this._backoffInitial&&(this._maxRetries+=1)}static init(e,t={}){return new m(e,t).start()}_destroy(){this._isRunning=!1,this._isDestroyed=!0}_failure(e){if(!this._isDestroyed)if(e&&"retryAfter"in e)this._retryAfter(e);else{const t=this._counter.getTime(this._callCount);this._shouldRetry(t,e)?(this._callCount++,this._tickInterval=setTimeout(()=>this._tick(),t)):(this._resolver.reject(e),this._destroy())}}_retryAfter(e){this._callCount++,this._tickInterval=setTimeout(()=>this._tick(),e.retryAfter)}_success(...e){this._isDestroyed||(this._resolver.resolve(...e),this._destroy())}_shouldRetry(e,t){const n=Date.now()-this._ts+e;return this._callCount<this._maxRetries&&e<this._maxTime&&n<this._maxDuration&&this._retryPredicate(t)}_tick(){this._fn().then((...e)=>this._success(...e)).catch(e=>this._failure(e))}getResolver(){return this._resolver.promise}start(){return this._isDestroyed?Promise.reject(new Error("Backoff already consumed")):(this._isRunning||(this._ts=Date.now(),this._isRunning=!0,this._backoffInitial?(this._callCount=1,this._tickInterval=setTimeout(()=>this._tick(),this._counter.getTime(0))):this._tick()),this._resolver.promise)}stop(){clearTimeout(this._tickInterval),this._destroy()}getRetryCount(){return this._callCount}}var v,N=n(4321);!function(e){e.INVALID_PAYLOAD="INVALID_PAYLOAD",e.INVALID_NAME="INVALID_NAME",e.UNKNOWN_OWNER="UNKNOWN_OWNER",e.PAYLOAD_SIZE_LIMIT_EXCEEDED="PAYLOAD_SIZE_LIMIT_EXCEEDED"}(v||(v={}));var b="4.0.3",R=n(4322);class y{static pushToArrIfMissing(e,t){-1===e.indexOf(t)&&e.push(t)}static isMissingFromArray(e,t){return-1===e.indexOf(t)}}class w{_addEventsToEventSenderStatsData(e,t){Object.keys(t).map(n=>{for(let r=0;r<t[n].length;r++){const i=t[n][r];i.sequence_number<e[i.sequence_id][i.event_name].sequence_number_min&&(e[i.sequence_id][i.event_name].sequence_number_min=i.sequence_number),e[i.sequence_id][i.event_name].storage_size++}})}_initializeESSEventData(e,t,n){Object.keys(e).includes(n)||(e[n]={});for(const[r,i]of Object.entries(t))e[n][r]={sequence_number_min:i+1,sequence_number_next:i+1,storage_size:0}}_formatESS2UnauthEventData(e){const t={sequence_ids:[],event_names:[],loss_stats_num_entries_per_sequence_id:[],loss_stats_event_name_index:[],loss_stats_storage_sizes:[],loss_stats_sequence_number_mins:[],loss_stats_sequence_number_nexts:[]};return Object.entries(e).map(([e,n])=>{if(y.isMissingFromArray(t.sequence_ids,e))t.sequence_ids.push(e),t.loss_stats_num_entries_per_sequence_id.push(Object.keys(n).length);else{const r=t.sequence_ids.indexOf(e);t.loss_stats_num_entries_per_sequence_id[r]+=Object.keys(n).length}Object.entries(n).map(([e,n])=>{y.pushToArrIfMissing(t.event_names,e);const r=t.event_names.indexOf(e);t.loss_stats_event_name_index.push(r);const i=Object.keys(n);for(let e=0;e<i.length;e++){const r=`loss_stats_${i[e]}s`;t[r].push(n[i[e]])}})}),t}createESSEvent(e,t,n){const r={};this._initializeESSEventData(r,t,n),this._addEventsToEventSenderStatsData(r,e);return Object(R.createEventSenderStats2NonAuth)(this._formatESS2UnauthEventData(r))}}var C=n(3756);const P={generateBase64:function(e){return C.Base64.encode(function(e){let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(256*Math.random()|0);return t}(e))}};class I{constructor(){this._sequenceId=P.generateBase64(16),this._sequenceNumbers={}}static create(){return new I}getSequenceId(){return this._sequenceId}nextSequenceNumber(e){return this._sequenceNumbers[e]||(this._sequenceNumbers[e]=0),++this._sequenceNumbers[e]}getAllSequenceNumberCounters(){return this._sequenceNumbers}}const A={baseTime:200,ceiling:3e5,maxDuration:18e5};class S extends c.a{constructor(e){var t;super(),this._sequenceIdGenerator=I.create(),this._statsSender=new w,this._instanceContexts={},this._sdkVersion=`${b}${null!==(t=e._experimentSuffix)&&void 0!==t?t:""}`,this._transport=e.transport,this._ownerProvider=e.ownerProvider,this._events={authorized:[],unauthorized:[]},this._uploaders=e.uploaders,this._ongoingUploads={authorized:!1,unauthorized:!1},this._uploadWaiting={authorized:!1,unauthorized:!1},this._backoffTimeSettings=Object.assign(Object.assign({},A),e.backoffTimeOverrides),this.upload=this.upload.bind(this),this._essLastSent=null;"undefined"!=typeof window&&"function"==typeof window.addEventListener&&!e.disableBeforeUnloadListener&&window.addEventListener("beforeunload",this.onBeforeDisconnect.bind(this)),this.initializeContexts(e.context);const n={[i.UPLOAD_SUCCEEDED]:i.UPLOAD_SUCCEEDED,[i.UPLOAD_FAILED]:i.UPLOAD_FAILED,[i.UPLOAD_REQUEST_FAILED]:i.UPLOAD_REQUEST_FAILED};this.proxyEmitAll(this._uploaders.authorized,n),this.proxyEmitAll(this._uploaders.unauthorized,n)}onBeforeDisconnect(){this.uploadFlush()}uploadFlush(){return Promise.all([this._uploaders.authorized.lastUpload(this._events.authorized.splice(0)),this._uploaders.unauthorized.lastUpload(this._events.unauthorized.splice(0))]).then(([e,t])=>e&&t).catch(()=>!1)}initializeContexts(e){if(!(null==e?void 0:e.length))return;const t=this._instanceContexts;for(const n of e){const e=n();(null==e?void 0:e.name)&&(t[e.name]=e.data)}}initFlush(e){const t=this._uploaders[e].shouldBackoff(),{ceiling:n,maxDuration:r,baseTime:i}=this._backoffTimeSettings;return m.init(()=>this.upload(e),{curve:"exponential",backoffInitial:t,retryPredicate:()=>this._transport.isOnline(),ceiling:n,baseTime:t?n:i,maxDuration:r})}waitForConnection(){return new Promise(e=>{this._transport.once(s.TransportEvent.CONNECTION_ONLINE,()=>e())})}upload(e){return this._uploaders[e].upload(this._events[e].splice(0)).then(t=>{if(t.nack.length)throw this._events[e]=t.nack.concat(this._events[e]),new Error("Backoff requested");return t})}sendToGabito(e){const t=e?"authorized":"unauthorized";this._transport.isOnline()||this._ongoingUploads[t]||(this._ongoingUploads[t]=this.waitForConnection());const n=this._ongoingUploads[t];if(n)return this._uploadWaiting[t]||(this._uploadWaiting[t]=!0,this._ongoingUploads[t]=n.then(()=>(this._ongoingUploads[t]=!1,this._uploadWaiting[t]=!1,this.sendToGabito(e)))),this._ongoingUploads[t];if(!this._events[t].length)return Promise.resolve({nack:this._events[t],backoff:this._uploaders[t].shouldBackoff()});if(!this._essLastSent||Date.now()-this._essLastSent.getTime()>3e5){const e=[this.makeEvent(this._statsSender.createESSEvent(this._events,this._sequenceIdGenerator.getAllSequenceNumberCounters(),this._sequenceIdGenerator.getSequenceId()))];this._uploaders.unauthorized.upload(e).finally(()=>{this._essLastSent=new Date})}const r=this.initFlush(t).then(e=>(this._ongoingUploads[t]=!1,e)).catch(()=>(this._ongoingUploads[t]=!1,this._transport.isOnline()?(S.consoleLogger.warn(`The events in the queue could not be uploaded. Throwing away ${this._events[t].length} ${t} events.`),this._events[t]=[],{nack:this._events[t],backoff:this._uploaders[t].shouldBackoff()}):this.sendToGabito(e)));return this._ongoingUploads[t]=r,r}storeEvent(e,t){const n=this.makeEvent(t);this._events[e?"authorized":"unauthorized"].push(n)}makeEvent(e){const t=this._sequenceIdGenerator;return{sequence_id:t.getSequenceId(),sequence_number:t.nextSequenceNumber(e.name),event_name:e.name,fragments:Object.assign(Object.assign({context_sdk:{version_name:this._sdkVersion,type:"javascript"},context_time:{timestamp:Date.now()}},this._instanceContexts),{message:e.data})}}validateEventData(e,t,n){return e.name?function(e){let t=e.length,n=t;for(;n--;){const r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}(JSON.stringify(e.data))>5e3?v.PAYLOAD_SIZE_LIMIT_EXCEEDED:t&&n&&!n()?v.UNKNOWN_OWNER:null:v.INVALID_NAME}checkIsEventAuthorized(e){return!e.endsWith("NonAuth")}flush(e=!0){return this.sendToGabito(e).then(()=>{}).catch(()=>{})}flushAll(){return Promise.all([this.sendToGabito(!0),this.sendToGabito(!1)]).then(()=>{}).catch(()=>{})}finalFlush(){return this.uploadFlush()}log(e,t={}){this.send(e,t)}send(e,{flush:t=!0}={}){const n=this.checkIsEventAuthorized(e.name);let r=this.validateEventData(e,n,this._ownerProvider);if(r===v.UNKNOWN_OWNER&&(S.consoleLogger.warn("Trying to send an authenticated event without a current owner: "+e.name),r=null),r){const t=Object(N.createRejectedClientEventNonAuth)({event_name:e.name,reject_reason:r});return this.storeEvent(!1,t),Promise.reject(new TypeError("The event is invalid and has been rejected for reason: "+r))}return this.storeEvent(n,e),t?this.flush(n):Promise.resolve()}hasContext(...e){return e.every(e=>!!this._instanceContexts[e])}}function D(e){const t={suppressPersist:e.suppressPersist,transport:e.transport};return new S(Object.assign(Object.assign({},e),{uploaders:{authorized:d(t),unauthorized:d(Object.assign(Object.assign({},t),{authorize:!1}))}}))}S.consoleLogger=a.forTag("EventSender")}}]);
//# sourceMappingURL=8-412b9f41ee8696a78043.js.map